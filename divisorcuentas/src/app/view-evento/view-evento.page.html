<!-- @import FormsModule -->
<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>{{ evento.title }}</ion-title>
    <ion-buttons slot="start">
      <ion-back-button [text]="getBackButtonText()" defaultHref="/home"></ion-back-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>


<ion-content *ngIf="evento">

  <div>
    <p>
      {{ evento.description }}
    </p>

    <div class="participants-section">

      <section>
        <ion-accordion-group>
          <ion-accordion value="first">
            <ion-item slot="header">
              <strong>Participantes:</strong>
            </ion-item>
            <div class="ion-padding" slot="content">
              <div class="space-y-2" style="width: 100%;">
                <div *ngFor="let participante of evento.participants"
                  class="flex items-center gap-4 p-3 rounded-lg bg-white dark:bg-background-dark/50"
                  style="background-color: #06192D;">

                  <div class="flex-grow">
                    <p class="font-semibold  dark:text-white">{{ participante.name }}</p>
                  </div>
                </div>

              </div>
            </div>
          </ion-accordion>

        </ion-accordion-group>

        <div class="mt-4 flex justify-end">
          <button [routerLink]="['/participantes', evento.id]"
            class="bg-primary/20 dark:bg-primary/30 text-primary font-bold py-2 px-4 rounded-lg text-sm">
            Editar Participantes
          </button>
        </div>
      </section>

      <section class="mt-8">


        <ion-item slot="header">
          <strong>Items:</strong>
        </ion-item>

        <div class="space-y-4">
          <div *ngFor="let item of evento.items; let i = index"
            class="p-4 rounded-lg bg-white dark:bg-background-dark/50 space-y-3" style="background-color: #06192D;">
            <div class="flex items-center gap-4">
              <div class="flex-grow">
                <p>{{ item.name }}</p>
                <div *ngIf="item.participant.length>0">
                  <span style="font-size: small;">Asignado a:</span>
                  <br>

                  <li *ngFor="let participant of item.participant; let i = index"
                    style="margin-left: 5rem;font-size: small;">
                    {{participant}}
                  </li>
                </div>
              </div>
              <div style="display: block; text-align: center;">

                <label style="margin: auto;">{{ item.price | clpCurrency }}</label>




                <br>



                <div style="position: relative; display: inline-block; width: 40px; height: 40px;">
                  <button class="p-2 -mr-2 text-gray-500 dark:text-gray-400 hover:text-primary dark:hover:text-primary"
                    style="width: 40px; height: 40px; position: absolute; left: 0; top: 0; z-index: 1; pointer-events: none;">
                    <span class="material-symbols-outlined">person_add</span>
                  </button>
                  <select #selectRef [(ngModel)]="item.participant" (ngModelChange)="calcularMontoApagar()"
                    multiple="true"
                    style="opacity:0; position:absolute; left:0; top:0; width:40px; height:40px; z-index:2; cursor:pointer;"
                    id="assign-decoracion">
                    <option *ngFor="let participante of evento.participants" [ngValue]="participante.name">{{
                      participante.name }}</option>
                  </select>
                </div>

              </div>
            </div>
          </div>

          <div *ngIf="incluyePropina" class="p-4 rounded-lg bg-white dark:bg-background-dark/50 space-y-3"
            style="background-color: #06192D;">
            <div class="flex items-center gap-4">
              <div class="flex-grow">
                <p>Propina</p>
              </div>
              <div style="display: block; text-align: center;">

                <label style="margin: auto;">{{ propina() | clpCurrency }}</label>


              </div>
            </div>
          </div>

          <div class="p-4 rounded-lg bg-white dark:bg-background-dark/50 space-y-3" style="background-color: #06192D;">
            <div class="flex items-center gap-4">
              <div class="flex-grow">
                <p>Total</p>
              </div>
              <div style="display: block; text-align: center;">

                <label style="margin: auto;">{{ total() | clpCurrency }}</label>

              </div>
            </div>
          </div>

        </div>
        <div class="mt-4 flex justify-end">
          <!--<ion-button size="small"  style="margin-left: 0.5rem;float: right;">{{(evento!.items!.length > 0)? "Editar": "Agregar"}}</ion-button>  -->
          <button [routerLink]="['/items', evento.id]"
            class="bg-primary/20 dark:bg-primary/30 text-primary font-bold py-2 px-4 rounded-lg text-sm">
            Editar items
          </button>
        </div>
      </section>

      <div *ngIf="evento.items && evento.items.length > 0">
        <label class="flex gap-x-3 py-3 items-center">
          <input [(ngModel)]="incluyePropina" checked=""
            class="h-5 w-5 rounded-lg border-2 bg-transparent text-primary checked:bg-primary checked:border-primary checked:bg-[image:--checkbox-tick-svg] focus:ring-0 focus:ring-offset-0 focus:border-[#1A5A96] border-[#1A5A96]"
            type="checkbox" />
          <p class="text-white text-base font-normal leading-normal">Incluye propina</p>
        </label>

      </div>

    </div>
    <!--<ion-button size="small" [routerLink]="['/participantes', evento.id]" style="margin-left: 1rem;float: right;">{{(evento.participants.length > 0)? "Editar": "Agregar"}}</ion-button>-->



    <div class="participants-section">

      <ion-item slot="header">
        <strong>Detalle por participante:</strong>
      </ion-item>
      <section class="mt-8">

        <div class="space-y-4">
          <div *ngFor="let participante of evento.participants"
            class="p-4 rounded-lg dark:bg-background-dark/50 space-y-3" style="background-color: #06192D;">
            <div class="flex items-center gap-4">
              <div class="flex-grow">
                <p>{{ participante.name }}</p>
              </div>
              <div>
                <td class=" text-sm   shrink-0" style="float: inline-end;">{{ participante.montoApagar | clpCurrency }}
                </td>

              </div>
            </div>
          </div>
          <div class="p-4 rounded-lg bg-white dark:bg-background-dark/50 space-y-3" style="background-color: #06192D;">
            <div class="flex items-center gap-4">
              <div class="flex-grow">
                <strong>Total</strong>
              </div>
              <div>
                <strong>{{ totalAsignado() | clpCurrency }}</strong>

              </div>
            </div>
          </div>

        </div>

      </section>
    </div>



    <br>
    <br><br>






  </div>

</ion-content>