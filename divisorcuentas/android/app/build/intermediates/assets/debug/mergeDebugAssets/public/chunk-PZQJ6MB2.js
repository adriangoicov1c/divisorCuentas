import{a as Js}from"./chunk-JLZ2UVSU.js";import{a as Vs}from"./chunk-ULNDTA5Q.js";import{a as $r,b as Xs,c as Ks}from"./chunk-2NHZZGHX.js";import{A as te,Aa as Ws,B as yn,Ba as Hs,C as hs,D as wn,E as xn,F as In,G as gs,H as _s,I as bs,J as ys,K as ws,L as xs,N as Is,P as As,S as Ps,W as Cs,Y as Ss,Z as Rs,ba as vs,d as kr,e as Y,f as Z,g as ee,ga as Es,i as ds,k as Tr,ka as Os,la as ks,ma as An,na as Ts,oa as $s,pa as Ms,q as Ce,qa as Fs,r as O,ra as Ns,s as T,sa as Ls,t as ce,u as Kt,ua as Bs,v as le,va as Us,w as ue,wa as js,x as fs,xa as Ds,y as ms,z as ps,za as qs}from"./chunk-BXOCLV3Y.js";import"./chunk-4LE76BWB.js";import"./chunk-73UBTZ6U.js";import"./chunk-QY5AYREC.js";import"./chunk-22BFWSH3.js";import"./chunk-JRVP6ISR.js";import"./chunk-YQTF3JKO.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-H3Z6NBHK.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{a as i,b as l,e as v,h as Xt,i as f,j as V,k as ge,l as us,m as F}from"./chunk-VZEDPC34.js";var _e=(function(n){return n.Prompt="PROMPT",n.Camera="CAMERA",n.Photos="PHOTOS",n})(_e||{}),Gt=(function(n){return n.Rear="REAR",n.Front="FRONT",n})(Gt||{}),Pn=(function(n){return n.Uri="uri",n.Base64="base64",n.DataUrl="dataUrl",n})(Pn||{});var zt=class extends Ks{getPhoto(e){return f(this,null,function*(){return new Promise((t,r)=>f(this,null,function*(){if(e.webUseInput||e.source===_e.Photos)this.fileInputExperience(e,t,r);else if(e.source===_e.Prompt){let s=document.querySelector("pwa-action-sheet");s||(s=document.createElement("pwa-action-sheet"),document.body.appendChild(s)),s.header=e.promptLabelHeader||"Photo",s.cancelable=!1,s.options=[{title:e.promptLabelPhoto||"From Photos"},{title:e.promptLabelPicture||"Take Picture"}],s.addEventListener("onSelection",o=>f(this,null,function*(){o.detail===0?this.fileInputExperience(e,t,r):this.cameraExperience(e,t,r)}))}else this.cameraExperience(e,t,r)}))})}pickImages(e){return f(this,null,function*(){return new Promise((t,r)=>f(this,null,function*(){this.multipleFileInputExperience(t,r)}))})}cameraExperience(e,t,r){return f(this,null,function*(){if(customElements.get("pwa-camera-modal")){let s=document.createElement("pwa-camera-modal");s.facingMode=e.direction===Gt.Front?"user":"environment",document.body.appendChild(s);try{yield s.componentOnReady(),s.addEventListener("onPhoto",o=>f(this,null,function*(){let a=o.detail;a===null?r(new $r("User cancelled photos app")):a instanceof Error?r(a):t(yield this._getCameraPhoto(a,e)),s.dismiss(),document.body.removeChild(s)})),s.present()}catch{this.fileInputExperience(e,t,r)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),this.fileInputExperience(e,t,r)})}fileInputExperience(e,t,r){let s=document.querySelector("#_capacitor-camera-input"),o=()=>{var a;(a=s.parentNode)===null||a===void 0||a.removeChild(s)};s||(s=document.createElement("input"),s.id="_capacitor-camera-input",s.type="file",s.hidden=!0,document.body.appendChild(s),s.addEventListener("change",a=>{let c=s.files[0],h="jpeg";if(c.type==="image/png"?h="png":c.type==="image/gif"&&(h="gif"),e.resultType==="dataUrl"||e.resultType==="base64"){let p=new FileReader;p.addEventListener("load",()=>{if(e.resultType==="dataUrl")t({dataUrl:p.result,format:h});else if(e.resultType==="base64"){let x=p.result.split(",")[1];t({base64String:x,format:h})}o()}),p.readAsDataURL(c)}else t({webPath:URL.createObjectURL(c),format:h}),o()}),s.addEventListener("cancel",a=>{r(new $r("User cancelled photos app")),o()})),s.accept="image/*",s.capture=!0,e.source===_e.Photos||e.source===_e.Prompt?s.removeAttribute("capture"):e.direction===Gt.Front?s.capture="user":e.direction===Gt.Rear&&(s.capture="environment"),s.click()}multipleFileInputExperience(e,t){let r=document.querySelector("#_capacitor-camera-input-multiple"),s=()=>{var o;(o=r.parentNode)===null||o===void 0||o.removeChild(r)};r||(r=document.createElement("input"),r.id="_capacitor-camera-input-multiple",r.type="file",r.hidden=!0,r.multiple=!0,document.body.appendChild(r),r.addEventListener("change",o=>{let a=[];for(let c=0;c<r.files.length;c++){let h=r.files[c],p="jpeg";h.type==="image/png"?p="png":h.type==="image/gif"&&(p="gif"),a.push({webPath:URL.createObjectURL(h),format:p})}e({photos:a}),s()}),r.addEventListener("cancel",o=>{t(new $r("User cancelled photos app")),s()})),r.accept="image/*",r.click()}_getCameraPhoto(e,t){return new Promise((r,s)=>{let o=new FileReader,a=e.type.split("/")[1];t.resultType==="uri"?r({webPath:URL.createObjectURL(e),format:a,saved:!1}):(o.readAsDataURL(e),o.onloadend=()=>{let c=o.result;t.resultType==="dataUrl"?r({dataUrl:c,format:a,saved:!1}):r({base64String:c.split(",")[1],format:a,saved:!1})},o.onerror=c=>{s(c)})})}checkPermissions(){return f(this,null,function*(){if(typeof navigator>"u"||!navigator.permissions)throw this.unavailable("Permissions API not available in this browser");try{return{camera:(yield window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw this.unavailable("Camera permissions are not available in this browser")}})}requestPermissions(){return f(this,null,function*(){throw this.unimplemented("Not implemented on web.")})}pickLimitedLibraryPhotos(){return f(this,null,function*(){throw this.unavailable("Not implemented on web.")})}getLimitedLibraryPhotos(){return f(this,null,function*(){throw this.unavailable("Not implemented on web.")})}},Ma=new zt;var Gs=Xs("Camera",{web:()=>new zt});var zs={production:!0,geminiApiKey:"AIzaSyAFEo4r7WAUNpEI3yDMMoTJm1DyY1ijMRw"};function A(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t}function u(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)}var Cn=function(){let{crypto:n}=globalThis;if(n?.randomUUID)return Cn=n.randomUUID.bind(n),n.randomUUID();let e=new Uint8Array(1),t=n?()=>n.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,r=>(+r^t()&15>>+r/4).toString(16))};function Qt(n){return typeof n=="object"&&n!==null&&("name"in n&&n.name==="AbortError"||"message"in n&&String(n.message).includes("FetchRequestCanceledException"))}var Yt=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null){try{if(Object.prototype.toString.call(n)==="[object Error]"){let e=new Error(n.message,n.cause?{cause:n.cause}:{});return n.stack&&(e.stack=n.stack),n.cause&&!e.cause&&(e.cause=n.cause),n.name&&(e.name=n.name),e}}catch{}try{return new Error(JSON.stringify(n))}catch{}}return new Error(n)};var w=class extends Error{},j=class n extends w{constructor(e,t,r,s){super(`${n.makeMessage(e,t,r)}`),this.status=e,this.headers=s,this.requestID=s?.get("x-request-id"),this.error=t;let o=t;this.code=o?.code,this.param=o?.param,this.type=o?.type}static makeMessage(e,t,r){let s=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e||!s)return new Te({message:r,cause:Yt(t)});let o=t?.error;return e===400?new rt(e,o,r,s):e===401?new nt(e,o,r,s):e===403?new st(e,o,r,s):e===404?new ot(e,o,r,s):e===409?new it(e,o,r,s):e===422?new at(e,o,r,s):e===429?new lt(e,o,r,s):e>=500?new ct(e,o,r,s):new n(e,o,r,s)}},U=class extends j{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},Te=class extends j{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},$e=class extends Te{constructor({message:e}={}){super({message:e??"Request timed out."})}},rt=class extends j{},nt=class extends j{},st=class extends j{},ot=class extends j{},it=class extends j{},at=class extends j{},lt=class extends j{},ct=class extends j{},ut=class extends w{constructor(){super("Could not parse response content as the length limit was reached")}},dt=class extends w{constructor(){super("Could not parse response content as the request was rejected by the content filter")}},be=class extends Error{constructor(e){super(e)}};var ti=/^[a-z][a-z0-9+.-]*:/i,Qs=n=>ti.test(n),G=n=>(G=Array.isArray,G(n)),Sn=G;function Rn(n){return typeof n!="object"?{}:n??{}}function Ys(n){if(!n)return!0;for(let e in n)return!1;return!0}function Zs(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function ft(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}var eo=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new w(`${n} must be an integer`);if(e<0)throw new w(`${n} must be a positive integer`);return e};var to=n=>{try{return JSON.parse(n)}catch{return}};var ye=n=>new Promise(e=>setTimeout(e,n));var Me="6.9.1";var oo=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function ri(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}var ni=()=>{let n=ri();if(n==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Me,"X-Stainless-OS":no(Deno.build.os),"X-Stainless-Arch":ro(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Me,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(n==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Me,"X-Stainless-OS":no(globalThis.process.platform??"unknown"),"X-Stainless-Arch":ro(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let e=si();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Me,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Me,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function si(){if(typeof navigator>"u"||!navigator)return null;let n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of n){let r=t.exec(navigator.userAgent);if(r){let s=r[1]||0,o=r[2]||0,a=r[3]||0;return{browser:e,version:`${s}.${o}.${a}`}}}return null}var ro=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",no=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown"),so,io=()=>so??(so=ni());function ao(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function vn(...n){let e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...n)}function Mr(n){let e=Symbol.asyncIterator in n?n[Symbol.asyncIterator]():n[Symbol.iterator]();return vn({start(){},pull(r){return f(this,null,function*(){let{done:s,value:o}=yield e.next();s?r.close():r.enqueue(o)})},cancel(){return f(this,null,function*(){yield e.return?.()})}})}function En(n){if(n[Symbol.asyncIterator])return n;let e=n.getReader();return{next(){return f(this,null,function*(){try{let r=yield e.read();return r?.done&&e.releaseLock(),r}catch(r){throw e.releaseLock(),r}})},return(){return f(this,null,function*(){let r=e.cancel();return e.releaseLock(),yield r,{done:!0,value:void 0}})},[Symbol.asyncIterator](){return this}}}function lo(n){return f(this,null,function*(){if(n===null||typeof n!="object")return;if(n[Symbol.asyncIterator]){yield n[Symbol.asyncIterator]().return?.();return}let e=n.getReader(),t=e.cancel();e.releaseLock(),yield t})}var co=({headers:n,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});var Fr="RFC3986",On=n=>String(n),Nr={RFC1738:n=>String(n).replace(/%20/g,"+"),RFC3986:On},kn="RFC1738";var Lr=(n,e)=>(Lr=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),Lr(n,e)),we=(()=>{let n=[];for(let e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n})();var Tn=1024,uo=(n,e,t,r,s)=>{if(n.length===0)return n;let o=n;if(typeof n=="symbol"?o=Symbol.prototype.toString.call(n):typeof n!="string"&&(o=String(n)),t==="iso-8859-1")return escape(o).replace(/%u[0-9a-f]{4}/gi,function(c){return"%26%23"+parseInt(c.slice(2),16)+"%3B"});let a="";for(let c=0;c<o.length;c+=Tn){let h=o.length>=Tn?o.slice(c,c+Tn):o,p=[];for(let x=0;x<h.length;++x){let g=h.charCodeAt(x);if(g===45||g===46||g===95||g===126||g>=48&&g<=57||g>=65&&g<=90||g>=97&&g<=122||s===kn&&(g===40||g===41)){p[p.length]=h.charAt(x);continue}if(g<128){p[p.length]=we[g];continue}if(g<2048){p[p.length]=we[192|g>>6]+we[128|g&63];continue}if(g<55296||g>=57344){p[p.length]=we[224|g>>12]+we[128|g>>6&63]+we[128|g&63];continue}x+=1,g=65536+((g&1023)<<10|h.charCodeAt(x)&1023),p[p.length]=we[240|g>>18]+we[128|g>>12&63]+we[128|g>>6&63]+we[128|g&63]}a+=p.join("")}return a};function fo(n){return!n||typeof n!="object"?!1:!!(n.constructor&&n.constructor.isBuffer&&n.constructor.isBuffer(n))}function $n(n,e){if(G(n)){let t=[];for(let r=0;r<n.length;r+=1)t.push(e(n[r]));return t}return e(n)}var po={brackets(n){return String(n)+"[]"},comma:"comma",indices(n,e){return String(n)+"["+e+"]"},repeat(n){return String(n)}},ho=function(n,e){Array.prototype.push.apply(n,G(e)?e:[e])},mo,D={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:uo,encodeValuesOnly:!1,format:Fr,formatter:On,indices:!1,serializeDate(n){return(mo??(mo=Function.prototype.call.bind(Date.prototype.toISOString)))(n)},skipNulls:!1,strictNullHandling:!1};function ai(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n=="symbol"||typeof n=="bigint"}var Mn={};function go(n,e,t,r,s,o,a,c,h,p,x,g,_,b,I,K,$,E){let P=n,L=E,W=0,H=!1;for(;(L=L.get(Mn))!==void 0&&!H;){let k=L.get(n);if(W+=1,typeof k<"u"){if(k===W)throw new RangeError("Cyclic object value");H=!0}typeof L.get(Mn)>"u"&&(W=0)}if(typeof p=="function"?P=p(e,P):P instanceof Date?P=_?.(P):t==="comma"&&G(P)&&(P=$n(P,function(k){return k instanceof Date?_?.(k):k})),P===null){if(o)return h&&!K?h(e,D.encoder,$,"key",b):e;P=""}if(ai(P)||fo(P)){if(h){let k=K?e:h(e,D.encoder,$,"key",b);return[I?.(k)+"="+I?.(h(P,D.encoder,$,"value",b))]}return[I?.(e)+"="+I?.(String(P))]}let R=[];if(typeof P>"u")return R;let B;if(t==="comma"&&G(P))K&&h&&(P=$n(P,h)),B=[{value:P.length>0?P.join(",")||null:void 0}];else if(G(p))B=p;else{let k=Object.keys(P);B=x?k.sort(x):k}let z=c?String(e).replace(/\./g,"%2E"):String(e),M=r&&G(P)&&P.length===1?z+"[]":z;if(s&&G(P)&&P.length===0)return M+"[]";for(let k=0;k<B.length;++k){let ie=B[k],Be=typeof ie=="object"&&typeof ie.value<"u"?ie.value:P[ie];if(a&&Be===null)continue;let ae=g&&c?ie.replace(/\./g,"%2E"):ie,me=G(P)?typeof t=="function"?t(M,ae):M:M+(g?"."+ae:"["+ae+"]");E.set(n,W);let pe=new WeakMap;pe.set(Mn,E),ho(R,go(Be,me,t,r,s,o,a,c,t==="comma"&&K&&G(P)?null:h,p,x,g,_,b,I,K,$,pe))}return R}function li(n=D){if(typeof n.allowEmptyArrays<"u"&&typeof n.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof n.encodeDotInKeys<"u"&&typeof n.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(n.encoder!==null&&typeof n.encoder<"u"&&typeof n.encoder!="function")throw new TypeError("Encoder has to be a function.");let e=n.charset||D.charset;if(typeof n.charset<"u"&&n.charset!=="utf-8"&&n.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Fr;if(typeof n.format<"u"){if(!Lr(Nr,n.format))throw new TypeError("Unknown format option provided.");t=n.format}let r=Nr[t],s=D.filter;(typeof n.filter=="function"||G(n.filter))&&(s=n.filter);let o;if(n.arrayFormat&&n.arrayFormat in po?o=n.arrayFormat:"indices"in n?o=n.indices?"indices":"repeat":o=D.arrayFormat,"commaRoundTrip"in n&&typeof n.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");let a=typeof n.allowDots>"u"?n.encodeDotInKeys?!0:D.allowDots:!!n.allowDots;return{addQueryPrefix:typeof n.addQueryPrefix=="boolean"?n.addQueryPrefix:D.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof n.allowEmptyArrays=="boolean"?!!n.allowEmptyArrays:D.allowEmptyArrays,arrayFormat:o,charset:e,charsetSentinel:typeof n.charsetSentinel=="boolean"?n.charsetSentinel:D.charsetSentinel,commaRoundTrip:!!n.commaRoundTrip,delimiter:typeof n.delimiter>"u"?D.delimiter:n.delimiter,encode:typeof n.encode=="boolean"?n.encode:D.encode,encodeDotInKeys:typeof n.encodeDotInKeys=="boolean"?n.encodeDotInKeys:D.encodeDotInKeys,encoder:typeof n.encoder=="function"?n.encoder:D.encoder,encodeValuesOnly:typeof n.encodeValuesOnly=="boolean"?n.encodeValuesOnly:D.encodeValuesOnly,filter:s,format:t,formatter:r,serializeDate:typeof n.serializeDate=="function"?n.serializeDate:D.serializeDate,skipNulls:typeof n.skipNulls=="boolean"?n.skipNulls:D.skipNulls,sort:typeof n.sort=="function"?n.sort:null,strictNullHandling:typeof n.strictNullHandling=="boolean"?n.strictNullHandling:D.strictNullHandling}}function Fn(n,e={}){let t=n,r=li(e),s,o;typeof r.filter=="function"?(o=r.filter,t=o("",t)):G(r.filter)&&(o=r.filter,s=o);let a=[];if(typeof t!="object"||t===null)return"";let c=po[r.arrayFormat],h=c==="comma"&&r.commaRoundTrip;s||(s=Object.keys(t)),r.sort&&s.sort(r.sort);let p=new WeakMap;for(let _=0;_<s.length;++_){let b=s[_];r.skipNulls&&t[b]===null||ho(a,go(t[b],b,c,h,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,p))}let x=a.join(r.delimiter),g=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?g+="utf8=%26%2310003%3B&":g+="utf8=%E2%9C%93&"),x.length>0?g+x:""}function yo(n){let e=0;for(let s of n)e+=s.length;let t=new Uint8Array(e),r=0;for(let s of n)t.set(s,r),r+=s.length;return t}var _o;function mt(n){let e;return(_o??(e=new globalThis.TextEncoder,_o=e.encode.bind(e)))(n)}var bo;function Nn(n){let e;return(bo??(e=new globalThis.TextDecoder,bo=e.decode.bind(e)))(n)}var re,ne,Ue=class{constructor(){re.set(this,void 0),ne.set(this,void 0),A(this,re,new Uint8Array,"f"),A(this,ne,null,"f")}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?mt(e):e;A(this,re,yo([u(this,re,"f"),t]),"f");let r=[],s;for(;(s=ui(u(this,re,"f"),u(this,ne,"f")))!=null;){if(s.carriage&&u(this,ne,"f")==null){A(this,ne,s.index,"f");continue}if(u(this,ne,"f")!=null&&(s.index!==u(this,ne,"f")+1||s.carriage)){r.push(Nn(u(this,re,"f").subarray(0,u(this,ne,"f")-1))),A(this,re,u(this,re,"f").subarray(u(this,ne,"f")),"f"),A(this,ne,null,"f");continue}let o=u(this,ne,"f")!==null?s.preceding-1:s.preceding,a=Nn(u(this,re,"f").subarray(0,o));r.push(a),A(this,re,u(this,re,"f").subarray(s.index),"f"),A(this,ne,null,"f")}return r}flush(){return u(this,re,"f").length?this.decode(`
`):[]}};re=new WeakMap,ne=new WeakMap;Ue.NEWLINE_CHARS=new Set([`
`,"\r"]);Ue.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function ui(n,e){for(let s=e??0;s<n.length;s++){if(n[s]===10)return{preceding:s,index:s+1,carriage:!1};if(n[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function wo(n){for(let r=0;r<n.length-1;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}var Ur={off:0,error:200,warn:300,info:400,debug:500},Ln=(n,e,t)=>{if(n){if(Zs(Ur,n))return n;N(t).warn(`${e} was set to ${JSON.stringify(n)}, expected one of ${JSON.stringify(Object.keys(Ur))}`)}};function Zt(){}function Br(n,e,t){return!e||Ur[n]>Ur[t]?Zt:e[n].bind(e)}var di={error:Zt,warn:Zt,info:Zt,debug:Zt},xo=new WeakMap;function N(n){let e=n.logger,t=n.logLevel??"off";if(!e)return di;let r=xo.get(e);if(r&&r[0]===t)return r[1];let s={error:Br("error",e,t),warn:Br("warn",e,t),info:Br("info",e,t),debug:Br("debug",e,t)};return xo.set(e,[t,s]),s}var Se=n=>(n.options&&(n.options=i({},n.options),delete n.options.headers),n.headers&&(n.headers=Object.fromEntries((n.headers instanceof Headers?[...n.headers]:Object.entries(n.headers)).map(([e,t])=>[e,e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in n&&(n.retryOfRequestLogID&&(n.retryOf=n.retryOfRequestLogID),delete n.retryOfRequestLogID),n);var er,xe=class n{constructor(e,t,r){this.iterator=e,er.set(this,void 0),this.controller=t,A(this,er,r,"f")}static fromSSEResponse(e,t,r){let s=!1,o=r?N(r):console;function a(){return ge(this,null,function*(){if(s)throw new w("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let c=!1;try{try{for(var h=F(fi(e,t)),p,x,g;p=!(x=yield new V(h.next())).done;p=!1){let _=x.value;if(!c){if(_.data.startsWith("[DONE]")){c=!0;continue}if(_.event===null||!_.event.startsWith("thread.")){let b;try{b=JSON.parse(_.data)}catch(I){throw o.error("Could not parse message into JSON:",_.data),o.error("From chunk:",_.raw),I}if(b&&b.error)throw new j(void 0,b.error,void 0,e.headers);yield b}else{let b;try{b=JSON.parse(_.data)}catch(I){throw console.error("Could not parse message into JSON:",_.data),console.error("From chunk:",_.raw),I}if(_.event=="error")throw new j(void 0,b.error,b.message,void 0);yield{event:_.event,data:b}}}}}catch{g=[x]}finally{try{p&&(x=h.return)&&(yield new V(x.call(h)))}finally{if(g)throw g[0]}}c=!0}catch(_){if(Qt(_))return;throw _}finally{c||t.abort()}})}return new n(a,t,r)}static fromReadableStream(e,t,r){let s=!1;function o(){return ge(this,null,function*(){let c=new Ue,h=En(e);try{for(var p=F(h),x,g,_;x=!(g=yield new V(p.next())).done;x=!1){let b=g.value;for(let I of c.decode(b))yield I}}catch{_=[g]}finally{try{x&&(g=p.return)&&(yield new V(g.call(p)))}finally{if(_)throw _[0]}}for(let b of c.flush())yield b})}function a(){return ge(this,null,function*(){if(s)throw new w("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let c=!1;try{try{for(var h=F(o()),p,x,g;p=!(x=yield new V(h.next())).done;p=!1){let _=x.value;c||_&&(yield JSON.parse(_))}}catch{g=[x]}finally{try{p&&(x=h.return)&&(yield new V(x.call(h)))}finally{if(g)throw g[0]}}c=!0}catch(_){if(Qt(_))return;throw _}finally{c||t.abort()}})}return new n(a,t,r)}[(er=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),s=o=>({next:()=>{if(o.length===0){let a=r.next();e.push(a),t.push(a)}return o.shift()}});return[new n(()=>s(e),this.controller,u(this,er,"f")),new n(()=>s(t),this.controller,u(this,er,"f"))]}toReadableStream(){let e=this,t;return vn({start(){return f(this,null,function*(){t=e[Symbol.asyncIterator]()})},pull(s){return f(this,null,function*(){try{let{value:o,done:a}=yield t.next();if(a)return s.close();let c=mt(JSON.stringify(o)+`
`);s.enqueue(c)}catch(o){s.error(o)}})},cancel(){return f(this,null,function*(){yield t.return?.()})}})}};function fi(n,e){return ge(this,null,function*(){if(!n.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new w("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new w("Attempted to iterate over a response with no body");let t=new Bn,r=new Ue,s=En(n.body);try{for(var o=F(mi(s)),a,c,h;a=!(c=yield new V(o.next())).done;a=!1){let p=c.value;for(let x of r.decode(p)){let g=t.decode(x);g&&(yield g)}}}catch{h=[c]}finally{try{a&&(c=o.return)&&(yield new V(c.call(o)))}finally{if(h)throw h[0]}}for(let p of r.flush()){let x=t.decode(p);x&&(yield x)}})}function mi(n){return ge(this,null,function*(){let e=new Uint8Array;try{for(var t=F(n),r,s,o;r=!(s=yield new V(t.next())).done;r=!1){let a=s.value;if(a==null)continue;let c=a instanceof ArrayBuffer?new Uint8Array(a):typeof a=="string"?mt(a):a,h=new Uint8Array(e.length+c.length);h.set(e),h.set(c,e.length),e=h;let p;for(;(p=wo(e))!==-1;)yield e.slice(0,p),e=e.slice(p)}}catch{o=[s]}finally{try{r&&(s=t.return)&&(yield new V(s.call(t)))}finally{if(o)throw o[0]}}e.length>0&&(yield e)})}var Bn=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let o={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],o}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=pi(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}};function pi(n,e){let t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}function jr(n,e){return f(this,null,function*(){let{response:t,requestLogID:r,retryOfRequestLogID:s,startTime:o}=e,a=yield f(null,null,function*(){if(e.options.stream)return N(n).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,n):xe.fromSSEResponse(t,e.controller,n);if(t.status===204)return null;if(e.options.__binaryResponse)return t;let h=t.headers.get("content-type")?.split(";")[0]?.trim();if(h?.includes("application/json")||h?.endsWith("+json")){let g=yield t.json();return Un(g,t)}return yield t.text()});return N(n).debug(`[${r}] response parsed`,Se({retryOfRequestLogID:s,url:t.url,status:t.status,body:a,durationMs:Date.now()-o})),a})}function Un(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var tr,je=class n extends Promise{constructor(e,t,r=jr){super(s=>{s(null)}),this.responsePromise=t,this.parseResponse=r,tr.set(this,void 0),A(this,tr,e,"f")}_thenUnwrap(e){return new n(u(this,tr,"f"),this.responsePromise,(t,r)=>f(this,null,function*(){return Un(e(yield this.parseResponse(t,r),r),r.response)}))}asResponse(){return this.responsePromise.then(e=>e.response)}withResponse(){return f(this,null,function*(){let[e,t]=yield Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}})}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(u(this,tr,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};tr=new WeakMap;var Dr,rr=class{constructor(e,t,r,s){Dr.set(this,void 0),A(this,Dr,e,"f"),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}getNextPage(){return f(this,null,function*(){let e=this.nextPageRequestOptions();if(!e)throw new w("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return yield u(this,Dr,"f").requestAPIList(this.constructor,e)})}iterPages(){return ge(this,null,function*(){let e=this;for(yield e;e.hasNextPage();)e=yield new V(e.getNextPage()),yield e})}[(Dr=new WeakMap,Symbol.asyncIterator)](){return ge(this,null,function*(){try{for(var e=F(this.iterPages()),t,r,s;t=!(r=yield new V(e.next())).done;t=!1){let o=r.value;for(let a of o.getPaginatedItems())yield a}}catch{s=[r]}finally{try{t&&(r=e.return)&&(yield new V(r.call(e)))}finally{if(s)throw s[0]}}})}},nr=class extends je{constructor(e,t,r){super(e,t,(s,o)=>f(null,null,function*(){return new r(s,o.response,yield jr(s,o),o.options)}))}[Symbol.asyncIterator](){return ge(this,null,function*(){let e=yield new V(this);try{for(var t=F(e),r,s,o;r=!(s=yield new V(t.next())).done;r=!1){let a=s.value;yield a}}catch{o=[s]}finally{try{r&&(s=t.return)&&(yield new V(s.call(t)))}finally{if(o)throw o[0]}}})}},Ie=class extends rr{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}},S=class extends rr{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.has_more=r.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){let e=this.getPaginatedItems(),t=e[e.length-1]?.id;return t?l(i({},this.options),{query:l(i({},Rn(this.options.query)),{after:t})}):null}},Re=class extends rr{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.has_more=r.has_more||!1,this.last_id=r.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){let e=this.last_id;return e?l(i({},this.options),{query:l(i({},Rn(this.options.query)),{after:e})}):null}};var qn=()=>{if(typeof File>"u"){let{process:n}=globalThis,e=typeof n?.versions?.node=="string"&&parseInt(n.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(e?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function pt(n,e,t){return qn(),new File(n,e??"unknown_file",t)}function sr(n){return(typeof n=="object"&&n!==null&&("name"in n&&n.name&&String(n.name)||"url"in n&&n.url&&String(n.url)||"filename"in n&&n.filename&&String(n.filename)||"path"in n&&n.path&&String(n.path))||"").split(/[\\/]/).pop()||void 0}var qr=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",Wn=(n,e)=>f(null,null,function*(){return jn(n.body)?l(i({},n),{body:yield Ao(n.body,e)}):n}),se=(n,e)=>f(null,null,function*(){return l(i({},n),{body:yield Ao(n.body,e)})}),Io=new WeakMap;function gi(n){let e=typeof n=="function"?n:n.fetch,t=Io.get(e);if(t)return t;let r=f(null,null,function*(){try{let s="Response"in e?e.Response:(yield e("data:,")).constructor,o=new FormData;return o.toString()!==(yield new s(o).text())}catch{return!0}});return Io.set(e,r),r}var Ao=(n,e)=>f(null,null,function*(){if(!(yield gi(e)))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let t=new FormData;return yield Promise.all(Object.entries(n||{}).map(([r,s])=>Dn(t,r,s))),t}),Po=n=>n instanceof Blob&&"name"in n,_i=n=>typeof n=="object"&&n!==null&&(n instanceof Response||qr(n)||Po(n)),jn=n=>{if(_i(n))return!0;if(Array.isArray(n))return n.some(jn);if(n&&typeof n=="object"){for(let e in n)if(jn(n[e]))return!0}return!1},Dn=(n,e,t)=>f(null,null,function*(){if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(t instanceof Response)n.append(e,pt([yield t.blob()],sr(t)));else if(qr(t))n.append(e,pt([yield new Response(Mr(t)).blob()],sr(t)));else if(Po(t))n.append(e,t,sr(t));else if(Array.isArray(t))yield Promise.all(t.map(r=>Dn(n,e+"[]",r)));else if(typeof t=="object")yield Promise.all(Object.entries(t).map(([r,s])=>Dn(n,`${e}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}});var Co=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",bi=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&Co(n),yi=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function";function Wr(n,e,t){return f(this,null,function*(){if(qn(),n=yield n,bi(n))return n instanceof File?n:pt([yield n.arrayBuffer()],n.name);if(yi(n)){let s=yield n.blob();return e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()),pt(yield Hn(s),e,t)}let r=yield Hn(n);if(e||(e=sr(n)),!t?.type){let s=r.find(o=>typeof o=="object"&&"type"in o&&o.type);typeof s=="string"&&(t=l(i({},t),{type:s}))}return pt(r,e,t)})}function Hn(n){return f(this,null,function*(){let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(Co(n))e.push(n instanceof Blob?n:yield n.arrayBuffer());else if(qr(n))try{for(var t=F(n),r,s,o;r=!(s=yield t.next()).done;r=!1){let a=s.value;e.push(...yield Hn(a))}}catch{o=[s]}finally{try{r&&(s=t.return)&&(yield s.call(t))}finally{if(o)throw o[0]}}else{let a=n?.constructor?.name;throw new Error(`Unexpected data type: ${typeof n}${a?`; constructor: ${a}`:""}${wi(n)}`)}return e})}function wi(n){return typeof n!="object"||n===null?"":`; props: [${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}var m=class{constructor(e){this._client=e}};function Ro(n){return n.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var So=Object.freeze(Object.create(null)),Ii=(n=Ro)=>function(t,...r){if(t.length===1)return t[0];let s=!1,o=[],a=t.reduce((x,g,_)=>{/[?#]/.test(g)&&(s=!0);let b=r[_],I=(s?encodeURIComponent:n)(""+b);return _!==r.length&&(b==null||typeof b=="object"&&b.toString===Object.getPrototypeOf(Object.getPrototypeOf(b.hasOwnProperty??So)??So)?.toString)&&(I=b+"",o.push({start:x.length+g.length,length:I.length,error:`Value of type ${Object.prototype.toString.call(b).slice(8,-1)} is not a valid path parameter`})),x+g+(_===r.length?"":I)},""),c=a.split(/[?#]/,1)[0],h=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi"),p;for(;(p=h.exec(c))!==null;)o.push({start:p.index,length:p[0].length,error:`Value "${p[0]}" can't be safely passed as a path parameter`});if(o.sort((x,g)=>x.start-g.start),o.length>0){let x=0,g=o.reduce((_,b)=>{let I=" ".repeat(b.start-x),K="^".repeat(b.length);return x=b.start+b.length,_+I+K},"");throw new w(`Path parameters result in path with invalid segments:
${o.map(_=>_.error).join(`
`)}
${a}
${g}`)}return a},d=Ii(Ro);var De=class extends m{list(e,t={},r){return this._client.getAPIList(d`/chat/completions/${e}/messages`,S,i({query:t},r))}};function or(n){return n!==void 0&&"function"in n&&n.function!==void 0}function ir(n){return n?.$brand==="auto-parseable-response-format"}function qe(n){return n?.$brand==="auto-parseable-tool"}function vo(n,e){return!e||!Vn(e)?l(i({},n),{choices:n.choices.map(t=>(Oo(t.message.tool_calls),l(i({},t),{message:i(l(i({},t.message),{parsed:null}),t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0)})))}):ar(n,e)}function ar(n,e){let t=n.choices.map(r=>{if(r.finish_reason==="length")throw new ut;if(r.finish_reason==="content_filter")throw new dt;return Oo(r.message.tool_calls),l(i({},r),{message:l(i(i({},r.message),r.message.tool_calls?{tool_calls:r.message.tool_calls?.map(s=>Si(e,s))??void 0}:void 0),{parsed:r.message.content&&!r.message.refusal?Ci(e,r.message.content):null})})});return l(i({},n),{choices:t})}function Ci(n,e){return n.response_format?.type!=="json_schema"?null:n.response_format?.type==="json_schema"?"$parseRaw"in n.response_format?n.response_format.$parseRaw(e):JSON.parse(e):null}function Si(n,e){let t=n.tools?.find(r=>or(r)&&r.function?.name===e.function.name);return l(i({},e),{function:l(i({},e.function),{parsed_arguments:qe(t)?t.$parseRaw(e.function.arguments):t?.function.strict?JSON.parse(e.function.arguments):null})})}function Eo(n,e){if(!n||!("tools"in n)||!n.tools)return!1;let t=n.tools?.find(r=>or(r)&&r.function?.name===e.function.name);return or(t)&&(qe(t)||t?.function.strict||!1)}function Vn(n){return ir(n.response_format)?!0:n.tools?.some(e=>qe(e)||e.type==="function"&&e.function.strict===!0)??!1}function Oo(n){for(let e of n||[])if(e.type!=="function")throw new w(`Currently only \`function\` tool calls are supported; Received \`${e.type}\``)}function ko(n){for(let e of n??[]){if(e.type!=="function")throw new w(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new w(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var ht=n=>n?.role==="assistant",Jn=n=>n?.role==="tool";var Xn,Hr,Vr,lr,cr,Jr,ur,ve,dr,Xr,Kr,gt,To,Fe=class{constructor(){Xn.add(this),this.controller=new AbortController,Hr.set(this,void 0),Vr.set(this,()=>{}),lr.set(this,()=>{}),cr.set(this,void 0),Jr.set(this,()=>{}),ur.set(this,()=>{}),ve.set(this,{}),dr.set(this,!1),Xr.set(this,!1),Kr.set(this,!1),gt.set(this,!1),A(this,Hr,new Promise((e,t)=>{A(this,Vr,e,"f"),A(this,lr,t,"f")}),"f"),A(this,cr,new Promise((e,t)=>{A(this,Jr,e,"f"),A(this,ur,t,"f")}),"f"),u(this,Hr,"f").catch(()=>{}),u(this,cr,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},u(this,Xn,"m",To).bind(this))},0)}_connected(){this.ended||(u(this,Vr,"f").call(this),this._emit("connect"))}get ended(){return u(this,dr,"f")}get errored(){return u(this,Xr,"f")}get aborted(){return u(this,Kr,"f")}abort(){this.controller.abort()}on(e,t){return(u(this,ve,"f")[e]||(u(this,ve,"f")[e]=[])).push({listener:t}),this}off(e,t){let r=u(this,ve,"f")[e];if(!r)return this;let s=r.findIndex(o=>o.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(u(this,ve,"f")[e]||(u(this,ve,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{A(this,gt,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}done(){return f(this,null,function*(){A(this,gt,!0,"f"),yield u(this,cr,"f")})}_emit(e,...t){if(u(this,dr,"f"))return;e==="end"&&(A(this,dr,!0,"f"),u(this,Jr,"f").call(this));let r=u(this,ve,"f")[e];if(r&&(u(this,ve,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){let s=t[0];!u(this,gt,"f")&&!r?.length&&Promise.reject(s),u(this,lr,"f").call(this,s),u(this,ur,"f").call(this,s),this._emit("end");return}if(e==="error"){let s=t[0];!u(this,gt,"f")&&!r?.length&&Promise.reject(s),u(this,lr,"f").call(this,s),u(this,ur,"f").call(this,s),this._emit("end")}}_emitFinal(){}};Hr=new WeakMap,Vr=new WeakMap,lr=new WeakMap,cr=new WeakMap,Jr=new WeakMap,ur=new WeakMap,ve=new WeakMap,dr=new WeakMap,Xr=new WeakMap,Kr=new WeakMap,gt=new WeakMap,Xn=new WeakSet,To=function(e){if(A(this,Xr,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new U),e instanceof U)return A(this,Kr,!0,"f"),this._emit("abort",e);if(e instanceof w)return this._emit("error",e);if(e instanceof Error){let t=new w(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new w(String(e)))};function $o(n){return typeof n.parse=="function"}var Q,Kn,Gr,Gn,zn,Qn,Mo,Fo,Ri=10,_t=class extends Fe{constructor(){super(...arguments),Q.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),Jn(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(ht(e)&&e.tool_calls)for(let r of e.tool_calls)r.type==="function"&&this._emit("functionToolCall",r.function)}}finalChatCompletion(){return f(this,null,function*(){yield this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new w("stream ended without producing a ChatCompletion");return e})}finalContent(){return f(this,null,function*(){return yield this.done(),u(this,Q,"m",Kn).call(this)})}finalMessage(){return f(this,null,function*(){return yield this.done(),u(this,Q,"m",Gr).call(this)})}finalFunctionToolCall(){return f(this,null,function*(){return yield this.done(),u(this,Q,"m",Gn).call(this)})}finalFunctionToolCallResult(){return f(this,null,function*(){return yield this.done(),u(this,Q,"m",zn).call(this)})}totalUsage(){return f(this,null,function*(){return yield this.done(),u(this,Q,"m",Qn).call(this)})}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=u(this,Q,"m",Gr).call(this);t&&this._emit("finalMessage",t);let r=u(this,Q,"m",Kn).call(this);r&&this._emit("finalContent",r);let s=u(this,Q,"m",Gn).call(this);s&&this._emit("finalFunctionToolCall",s);let o=u(this,Q,"m",zn).call(this);o!=null&&this._emit("finalFunctionToolCallResult",o),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",u(this,Q,"m",Qn).call(this))}_createChatCompletion(e,t,r){return f(this,null,function*(){let s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),u(this,Q,"m",Mo).call(this,t);let o=yield e.chat.completions.create(l(i({},t),{stream:!1}),l(i({},r),{signal:this.controller.signal}));return this._connected(),this._addChatCompletion(ar(o,t))})}_runChatCompletion(e,t,r){return f(this,null,function*(){for(let s of t.messages)this._addMessage(s,!1);return yield this._createChatCompletion(e,t,r)})}_runTools(e,t,r){return f(this,null,function*(){let s="tool",b=t,{tool_choice:o="auto",stream:a}=b,c=v(b,["tool_choice","stream"]),h=typeof o!="string"&&o.type==="function"&&o?.function?.name,{maxChatCompletions:p=Ri}=r||{},x=t.tools.map(I=>{if(qe(I)){if(!I.$callback)throw new w("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:I.$callback,name:I.function.name,description:I.function.description||"",parameters:I.function.parameters,parse:I.$parseRaw,strict:!0}}}return I}),g={};for(let I of x)I.type==="function"&&(g[I.function.name||I.function.function.name]=I.function);let _="tools"in t?x.map(I=>I.type==="function"?{type:"function",function:{name:I.function.name||I.function.function.name,parameters:I.function.parameters,description:I.function.description,strict:I.function.strict}}:I):void 0;for(let I of t.messages)this._addMessage(I,!1);for(let I=0;I<p;++I){let $=(yield this._createChatCompletion(e,l(i({},c),{tool_choice:o,tools:_,messages:[...this.messages]}),r)).choices[0]?.message;if(!$)throw new w("missing message in ChatCompletion response");if(!$.tool_calls?.length)return;for(let E of $.tool_calls){if(E.type!=="function")continue;let P=E.id,{name:L,arguments:W}=E.function,H=g[L];if(H){if(h&&h!==L){let M=`Invalid tool_call: ${JSON.stringify(L)}. ${JSON.stringify(h)} requested. Please try again`;this._addMessage({role:s,tool_call_id:P,content:M});continue}}else{let M=`Invalid tool_call: ${JSON.stringify(L)}. Available options are: ${Object.keys(g).map(k=>JSON.stringify(k)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:P,content:M});continue}let R;try{R=$o(H)?yield H.parse(W):W}catch(M){let k=M instanceof Error?M.message:String(M);this._addMessage({role:s,tool_call_id:P,content:k});continue}let B=yield H.function(R,this),z=u(this,Q,"m",Fo).call(this,B);if(this._addMessage({role:s,tool_call_id:P,content:z}),h)return}}})}};Q=new WeakSet,Kn=function(){return u(this,Q,"m",Gr).call(this).content??null},Gr=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(ht(t))return l(i({},t),{content:t.content??null,refusal:t.refusal??null})}throw new w("stream ended without producing a ChatCompletionMessage with role=assistant")},Gn=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(ht(t)&&t?.tool_calls?.length)return t.tool_calls.filter(r=>r.type==="function").at(-1)?.function}},zn=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(Jn(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(r=>r.role==="assistant"&&r.tool_calls?.some(s=>s.type==="function"&&s.id===t.tool_call_id)))return t.content}},Qn=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Mo=function(e){if(e.n!=null&&e.n>1)throw new w("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Fo=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};var fr=class n extends _t{static runTools(e,t,r){let s=new n,o=l(i({},r),{headers:l(i({},r?.headers),{"X-Stainless-Helper-Method":"runTools"})});return s._run(()=>s._runTools(e,t,o)),s}_addMessage(e,t=!0){super._addMessage(e,t),ht(e)&&e.content&&this._emit("content",e.content)}};var J={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,INF:384,SPECIAL:496,ATOM:499,COLLECTION:12,ALL:511},Yn=class extends Error{},Zn=class extends Error{};function vi(n,e=J.ALL){if(typeof n!="string")throw new TypeError(`expecting str, got ${typeof n}`);if(!n.trim())throw new Error(`${n} is empty`);return Ei(n.trim(),e)}var Ei=(n,e)=>{let t=n.length,r=0,s=_=>{throw new Yn(`${_} at position ${r}`)},o=_=>{throw new Zn(`${_} at position ${r}`)},a=()=>(g(),r>=t&&s("Unexpected end of input"),n[r]==='"'?c():n[r]==="{"?h():n[r]==="["?p():n.substring(r,r+4)==="null"||J.NULL&e&&t-r<4&&"null".startsWith(n.substring(r))?(r+=4,null):n.substring(r,r+4)==="true"||J.BOOL&e&&t-r<4&&"true".startsWith(n.substring(r))?(r+=4,!0):n.substring(r,r+5)==="false"||J.BOOL&e&&t-r<5&&"false".startsWith(n.substring(r))?(r+=5,!1):n.substring(r,r+8)==="Infinity"||J.INFINITY&e&&t-r<8&&"Infinity".startsWith(n.substring(r))?(r+=8,1/0):n.substring(r,r+9)==="-Infinity"||J.MINUS_INFINITY&e&&1<t-r&&t-r<9&&"-Infinity".startsWith(n.substring(r))?(r+=9,-1/0):n.substring(r,r+3)==="NaN"||J.NAN&e&&t-r<3&&"NaN".startsWith(n.substring(r))?(r+=3,NaN):x()),c=()=>{let _=r,b=!1;for(r++;r<t&&(n[r]!=='"'||b&&n[r-1]==="\\");)b=n[r]==="\\"?!b:!1,r++;if(n.charAt(r)=='"')try{return JSON.parse(n.substring(_,++r-Number(b)))}catch(I){o(String(I))}else if(J.STR&e)try{return JSON.parse(n.substring(_,r-Number(b))+'"')}catch{return JSON.parse(n.substring(_,n.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},h=()=>{r++,g();let _={};try{for(;n[r]!=="}";){if(g(),r>=t&&J.OBJ&e)return _;let b=c();g(),r++;try{let I=a();Object.defineProperty(_,b,{value:I,writable:!0,enumerable:!0,configurable:!0})}catch(I){if(J.OBJ&e)return _;throw I}g(),n[r]===","&&r++}}catch{if(J.OBJ&e)return _;s("Expected '}' at end of object")}return r++,_},p=()=>{r++;let _=[];try{for(;n[r]!=="]";)_.push(a()),g(),n[r]===","&&r++}catch{if(J.ARR&e)return _;s("Expected ']' at end of array")}return r++,_},x=()=>{if(r===0){n==="-"&&J.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n)}catch(b){if(J.NUM&e)try{return n[n.length-1]==="."?JSON.parse(n.substring(0,n.lastIndexOf("."))):JSON.parse(n.substring(0,n.lastIndexOf("e")))}catch{}o(String(b))}}let _=r;for(n[r]==="-"&&r++;n[r]&&!",]}".includes(n[r]);)r++;r==t&&!(J.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(n.substring(_,r))}catch{n.substring(_,r)==="-"&&J.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n.substring(_,n.lastIndexOf("e")))}catch(I){o(String(I))}}},g=()=>{for(;r<t&&` 
\r	`.includes(n[r]);)r++};return a()},es=n=>vi(n,J.ALL^J.NUM);var q,Ee,bt,Ne,ts,zr,rs,ns,ss,Qr,os,No,We=class n extends _t{constructor(e){super(),q.add(this),Ee.set(this,void 0),bt.set(this,void 0),Ne.set(this,void 0),A(this,Ee,e,"f"),A(this,bt,[],"f")}get currentChatCompletionSnapshot(){return u(this,Ne,"f")}static fromReadableStream(e){let t=new n(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){let s=new n(t);return s._run(()=>s._runChatCompletion(e,l(i({},t),{stream:!0}),l(i({},r),{headers:l(i({},r?.headers),{"X-Stainless-Helper-Method":"stream"})}))),s}_createChatCompletion(e,t,r){return f(this,null,function*(){Xt(n.prototype,this,"_createChatCompletion");let s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),u(this,q,"m",ts).call(this);let o=yield e.chat.completions.create(l(i({},t),{stream:!0}),l(i({},r),{signal:this.controller.signal}));this._connected();try{for(var a=F(o),c,h,p;c=!(h=yield a.next()).done;c=!1){let x=h.value;u(this,q,"m",rs).call(this,x)}}catch{p=[h]}finally{try{c&&(h=a.return)&&(yield h.call(a))}finally{if(p)throw p[0]}}if(o.controller.signal?.aborted)throw new U;return this._addChatCompletion(u(this,q,"m",Qr).call(this))})}_fromReadableStream(e,t){return f(this,null,function*(){let r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),u(this,q,"m",ts).call(this),this._connected();let s=xe.fromReadableStream(e,this.controller),o;try{for(var a=F(s),c,h,p;c=!(h=yield a.next()).done;c=!1){let x=h.value;o&&o!==x.id&&this._addChatCompletion(u(this,q,"m",Qr).call(this)),u(this,q,"m",rs).call(this,x),o=x.id}}catch{p=[h]}finally{try{c&&(h=a.return)&&(yield h.call(a))}finally{if(p)throw p[0]}}if(s.controller.signal?.aborted)throw new U;return this._addChatCompletion(u(this,q,"m",Qr).call(this))})}[(Ee=new WeakMap,bt=new WeakMap,Ne=new WeakMap,q=new WeakSet,ts=function(){this.ended||A(this,Ne,void 0,"f")},zr=function(t){let r=u(this,bt,"f")[t.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},u(this,bt,"f")[t.index]=r,r)},rs=function(t){if(this.ended)return;let r=u(this,q,"m",No).call(this,t);this._emit("chunk",t,r);for(let s of t.choices){let o=r.choices[s.index];s.delta.content!=null&&o.message?.role==="assistant"&&o.message?.content&&(this._emit("content",s.delta.content,o.message.content),this._emit("content.delta",{delta:s.delta.content,snapshot:o.message.content,parsed:o.message.parsed})),s.delta.refusal!=null&&o.message?.role==="assistant"&&o.message?.refusal&&this._emit("refusal.delta",{delta:s.delta.refusal,snapshot:o.message.refusal}),s.logprobs?.content!=null&&o.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:s.logprobs?.content,snapshot:o.logprobs?.content??[]}),s.logprobs?.refusal!=null&&o.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:s.logprobs?.refusal,snapshot:o.logprobs?.refusal??[]});let a=u(this,q,"m",zr).call(this,o);o.finish_reason&&(u(this,q,"m",ss).call(this,o),a.current_tool_call_index!=null&&u(this,q,"m",ns).call(this,o,a.current_tool_call_index));for(let c of s.delta.tool_calls??[])a.current_tool_call_index!==c.index&&(u(this,q,"m",ss).call(this,o),a.current_tool_call_index!=null&&u(this,q,"m",ns).call(this,o,a.current_tool_call_index)),a.current_tool_call_index=c.index;for(let c of s.delta.tool_calls??[]){let h=o.message.tool_calls?.[c.index];h?.type&&(h?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:h.function?.name,index:c.index,arguments:h.function.arguments,parsed_arguments:h.function.parsed_arguments,arguments_delta:c.function?.arguments??""}):(h?.type,void 0))}}},ns=function(t,r){if(u(this,q,"m",zr).call(this,t).done_tool_calls.has(r))return;let o=t.message.tool_calls?.[r];if(!o)throw new Error("no tool call snapshot");if(!o.type)throw new Error("tool call snapshot missing `type`");if(o.type==="function"){let a=u(this,Ee,"f")?.tools?.find(c=>or(c)&&c.function.name===o.function.name);this._emit("tool_calls.function.arguments.done",{name:o.function.name,index:r,arguments:o.function.arguments,parsed_arguments:qe(a)?a.$parseRaw(o.function.arguments):a?.function.strict?JSON.parse(o.function.arguments):null})}else o.type},ss=function(t){let r=u(this,q,"m",zr).call(this,t);if(t.message.content&&!r.content_done){r.content_done=!0;let s=u(this,q,"m",os).call(this);this._emit("content.done",{content:t.message.content,parsed:s?s.$parseRaw(t.message.content):null})}t.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),t.logprobs?.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),t.logprobs?.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},Qr=function(){if(this.ended)throw new w("stream has ended, this shouldn't happen");let t=u(this,Ne,"f");if(!t)throw new w("request ended without sending any chunks");return A(this,Ne,void 0,"f"),A(this,bt,[],"f"),Oi(t,u(this,Ee,"f"))},os=function(){let t=u(this,Ee,"f")?.response_format;return ir(t)?t:null},No=function(t){var r,s,o,a;let c=u(this,Ne,"f"),x=t,{choices:h}=x,p=v(x,["choices"]);c?Object.assign(c,p):c=A(this,Ne,l(i({},p),{choices:[]}),"f");for(let K of t.choices){let $=K,{delta:E,finish_reason:P,index:L,logprobs:W=null}=$,H=v($,["delta","finish_reason","index","logprobs"]);let R=c.choices[L];if(R||(R=c.choices[L]=i({finish_reason:P,index:L,message:{},logprobs:W},H)),W)if(!R.logprobs)R.logprobs=Object.assign({},W);else{let g=W,{content:ae,refusal:me}=g,pe=v(g,["content","refusal"]);Object.assign(R.logprobs,pe),ae&&((r=R.logprobs).content??(r.content=[]),R.logprobs.content.push(...ae)),me&&((s=R.logprobs).refusal??(s.refusal=[]),R.logprobs.refusal.push(...me))}if(P&&(R.finish_reason=P,u(this,Ee,"f")&&Vn(u(this,Ee,"f")))){if(P==="length")throw new ut;if(P==="content_filter")throw new dt}if(Object.assign(R,H),!E)continue;let _=E,{content:B,refusal:z,function_call:M,role:k,tool_calls:ie}=_,Be=v(_,["content","refusal","function_call","role","tool_calls"]);if(Object.assign(R.message,Be),z&&(R.message.refusal=(R.message.refusal||"")+z),k&&(R.message.role=k),M&&(R.message.function_call?(M.name&&(R.message.function_call.name=M.name),M.arguments&&((o=R.message.function_call).arguments??(o.arguments=""),R.message.function_call.arguments+=M.arguments)):R.message.function_call=M),B&&(R.message.content=(R.message.content||"")+B,!R.message.refusal&&u(this,q,"m",os).call(this)&&(R.message.parsed=es(R.message.content))),ie){R.message.tool_calls||(R.message.tool_calls=[]);for(let b of ie){let I=b,{index:ae,id:me,type:pe,function:Pe}=I,Or=v(I,["index","id","type","function"]);let he=(a=R.message.tool_calls)[ae]??(a[ae]={});Object.assign(he,Or),me&&(he.id=me),pe&&(he.type=pe),Pe&&(he.function??(he.function={name:Pe.name??"",arguments:""})),Pe?.name&&(he.function.name=Pe.name),Pe?.arguments&&(he.function.arguments+=Pe.arguments,Eo(u(this,Ee,"f"),he)&&(he.function.parsed_arguments=es(he.function.arguments)))}}}return c},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("chunk",s=>{let o=t.shift();o?o.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(let s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(let o of t)o.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(let o of t)o.reject(s);t.length=0}),{next:()=>f(this,null,function*(){return e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((o,a)=>t.push({resolve:o,reject:a})).then(o=>o?{value:o,done:!1}:{value:void 0,done:!0})}),return:()=>f(this,null,function*(){return this.abort(),{value:void 0,done:!0}})}}toReadableStream(){return new xe(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};function Oi(n,e){let p=n,{id:t,choices:r,created:s,model:o,system_fingerprint:a}=p,c=v(p,["id","choices","created","model","system_fingerprint"]),h=i(l(i({},c),{id:t,choices:r.map(K=>{var $=K,{message:x,finish_reason:g,index:_,logprobs:b}=$,I=v($,["message","finish_reason","index","logprobs"]);if(!g)throw new w(`missing finish_reason for choice ${_}`);let R=x,{content:E=null,function_call:P,tool_calls:L}=R,W=v(R,["content","function_call","tool_calls"]),H=x.role;if(!H)throw new w(`missing role for choice ${_}`);if(P){let{arguments:B,name:z}=P;if(B==null)throw new w(`missing function_call.arguments for choice ${_}`);if(!z)throw new w(`missing function_call.name for choice ${_}`);return l(i({},I),{message:{content:E,function_call:{arguments:B,name:z},role:H,refusal:x.refusal??null},finish_reason:g,index:_,logprobs:b})}return L?l(i({},I),{index:_,finish_reason:g,logprobs:b,message:l(i({},W),{role:H,content:E,refusal:x.refusal??null,tool_calls:L.map((B,z)=>{let Pe=B,{function:M,type:k,id:ie}=Pe,Be=v(Pe,["function","type","id"]),Or=M||{},{arguments:ae,name:me}=Or,pe=v(Or,["arguments","name"]);if(ie==null)throw new w(`missing choices[${_}].tool_calls[${z}].id
${Yr(n)}`);if(k==null)throw new w(`missing choices[${_}].tool_calls[${z}].type
${Yr(n)}`);if(me==null)throw new w(`missing choices[${_}].tool_calls[${z}].function.name
${Yr(n)}`);if(ae==null)throw new w(`missing choices[${_}].tool_calls[${z}].function.arguments
${Yr(n)}`);return l(i({},Be),{id:ie,type:k,function:l(i({},pe),{name:me,arguments:ae})})})})}):l(i({},I),{message:l(i({},W),{content:E,role:H,refusal:x.refusal??null}),finish_reason:g,index:_,logprobs:b})}),created:s,model:o,object:"chat.completion"}),a?{system_fingerprint:a}:{});return vo(h,e)}function Yr(n){return JSON.stringify(n)}var mr=class n extends We{static fromReadableStream(e){let t=new n(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,r){let s=new n(t),o=l(i({},r),{headers:l(i({},r?.headers),{"X-Stainless-Helper-Method":"runTools"})});return s._run(()=>s._runTools(e,t,o)),s}};var Oe=class extends m{constructor(){super(...arguments),this.messages=new De(this._client)}create(e,t){return this._client.post("/chat/completions",l(i({body:e},t),{stream:e.stream??!1}))}retrieve(e,t){return this._client.get(d`/chat/completions/${e}`,t)}update(e,t,r){return this._client.post(d`/chat/completions/${e}`,i({body:t},r))}list(e={},t){return this._client.getAPIList("/chat/completions",S,i({query:e},t))}delete(e,t){return this._client.delete(d`/chat/completions/${e}`,t)}parse(e,t){return ko(e.tools),this._client.chat.completions.create(e,l(i({},t),{headers:l(i({},t?.headers),{"X-Stainless-Helper-Method":"chat.completions.parse"})}))._thenUnwrap(r=>ar(r,e))}runTools(e,t){return e.stream?mr.runTools(this._client,e,t):fr.runTools(this._client,e,t)}stream(e,t){return We.createChatCompletion(this._client,e,t)}};Oe.Messages=De;var pr=(()=>{class n extends m{constructor(){super(...arguments),this.completions=new Oe(this._client)}}return n.Completions=Oe,n})();var Lo=Symbol("brand.privateNullableHeaders");function*Ti(n){if(!n)return;if(Lo in n){let{values:r,nulls:s}=n;yield*us(r.entries());for(let o of s)yield[o,null];return}let e=!1,t;n instanceof Headers?t=n.entries():Sn(n)?t=n:(e=!0,t=Object.entries(n??{}));for(let r of t){let s=r[0];if(typeof s!="string")throw new TypeError("expected header name to be a string");let o=Sn(r[1])?r[1]:[r[1]],a=!1;for(let c of o)c!==void 0&&(e&&!a&&(a=!0,yield[s,null]),yield[s,c])}}var y=n=>{let e=new Headers,t=new Set;for(let r of n){let s=new Set;for(let[o,a]of Ti(r)){let c=o.toLowerCase();s.has(c)||(e.delete(o),s.add(c)),a===null?(e.delete(o),t.add(c)):(e.append(o,a),t.delete(c))}}return{[Lo]:!0,values:e,nulls:t}};var yt=class extends m{create(e,t){return this._client.post("/audio/speech",l(i({body:e},t),{headers:y([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0}))}};var wt=class extends m{create(e,t){return this._client.post("/audio/transcriptions",se(l(i({body:e},t),{stream:e.stream??!1,__metadata:{model:e.model}}),this._client))}};var xt=class extends m{create(e,t){return this._client.post("/audio/translations",se(l(i({body:e},t),{__metadata:{model:e.model}}),this._client))}};var hr=(()=>{class n extends m{constructor(){super(...arguments),this.transcriptions=new wt(this._client),this.translations=new xt(this._client),this.speech=new yt(this._client)}}return n.Transcriptions=wt,n.Translations=xt,n.Speech=yt,n})();var He=class extends m{create(e,t){return this._client.post("/batches",i({body:e},t))}retrieve(e,t){return this._client.get(d`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",S,i({query:e},t))}cancel(e,t){return this._client.post(d`/batches/${e}/cancel`,t)}};var It=class extends m{create(e,t){return this._client.post("/assistants",l(i({body:e},t),{headers:y([{"OpenAI-Beta":"assistants=v2"},t?.headers])}))}retrieve(e,t){return this._client.get(d`/assistants/${e}`,l(i({},t),{headers:y([{"OpenAI-Beta":"assistants=v2"},t?.headers])}))}update(e,t,r){return this._client.post(d`/assistants/${e}`,l(i({body:t},r),{headers:y([{"OpenAI-Beta":"assistants=v2"},r?.headers])}))}list(e={},t){return this._client.getAPIList("/assistants",S,l(i({query:e},t),{headers:y([{"OpenAI-Beta":"assistants=v2"},t?.headers])}))}delete(e,t){return this._client.delete(d`/assistants/${e}`,l(i({},t),{headers:y([{"OpenAI-Beta":"assistants=v2"},t?.headers])}))}};var At=class extends m{create(e,t){return this._client.post("/realtime/sessions",l(i({body:e},t),{headers:y([{"OpenAI-Beta":"assistants=v2"},t?.headers])}))}};var Pt=class extends m{create(e,t){return this._client.post("/realtime/transcription_sessions",l(i({body:e},t),{headers:y([{"OpenAI-Beta":"assistants=v2"},t?.headers])}))}};var Zr=(()=>{class n extends m{constructor(){super(...arguments),this.sessions=new At(this._client),this.transcriptionSessions=new Pt(this._client)}}return n.Sessions=At,n.TranscriptionSessions=Pt,n})();var Ct=class extends m{create(e,t){return this._client.post("/chatkit/sessions",l(i({body:e},t),{headers:y([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])}))}cancel(e,t){return this._client.post(d`/chatkit/sessions/${e}/cancel`,l(i({},t),{headers:y([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])}))}};var St=class extends m{retrieve(e,t){return this._client.get(d`/chatkit/threads/${e}`,l(i({},t),{headers:y([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])}))}list(e={},t){return this._client.getAPIList("/chatkit/threads",Re,l(i({query:e},t),{headers:y([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])}))}delete(e,t){return this._client.delete(d`/chatkit/threads/${e}`,l(i({},t),{headers:y([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])}))}listItems(e,t={},r){return this._client.getAPIList(d`/chatkit/threads/${e}/items`,Re,l(i({query:t},r),{headers:y([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])}))}};var en=(()=>{class n extends m{constructor(){super(...arguments),this.sessions=new Ct(this._client),this.threads=new St(this._client)}}return n.Sessions=Ct,n.Threads=St,n})();var Rt=class extends m{create(e,t,r){return this._client.post(d`/threads/${e}/messages`,l(i({body:t},r),{headers:y([{"OpenAI-Beta":"assistants=v2"},r?.headers])}))}retrieve(e,t,r){let{thread_id:s}=t;return this._client.get(d`/threads/${s}/messages/${e}`,l(i({},r),{headers:y([{"OpenAI-Beta":"assistants=v2"},r?.headers])}))}update(e,t,r){let a=t,{thread_id:s}=a,o=v(a,["thread_id"]);return this._client.post(d`/threads/${s}/messages/${e}`,l(i({body:o},r),{headers:y([{"OpenAI-Beta":"assistants=v2"},r?.headers])}))}list(e,t={},r){return this._client.getAPIList(d`/threads/${e}/messages`,S,l(i({query:t},r),{headers:y([{"OpenAI-Beta":"assistants=v2"},r?.headers])}))}delete(e,t,r){let{thread_id:s}=t;return this._client.delete(d`/threads/${s}/messages/${e}`,l(i({},r),{headers:y([{"OpenAI-Beta":"assistants=v2"},r?.headers])}))}};var vt=class extends m{retrieve(e,t,r){let c=t,{thread_id:s,run_id:o}=c,a=v(c,["thread_id","run_id"]);return this._client.get(d`/threads/${s}/runs/${o}/steps/${e}`,l(i({query:a},r),{headers:y([{"OpenAI-Beta":"assistants=v2"},r?.headers])}))}list(e,t,r){let a=t,{thread_id:s}=a,o=v(a,["thread_id"]);return this._client.getAPIList(d`/threads/${s}/runs/${e}/steps`,S,l(i({query:o},r),{headers:y([{"OpenAI-Beta":"assistants=v2"},r?.headers])}))}};var Bo=n=>{if(typeof Buffer<"u"){let e=Buffer.from(n,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{let e=atob(n),t=e.length,r=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e.charCodeAt(s);return Array.from(new Float32Array(r.buffer))}};var de=n=>{if(typeof globalThis.process<"u")return globalThis.process.env?.[n]?.trim()??void 0;if(typeof globalThis.Deno<"u")return globalThis.Deno.env?.get?.(n)?.trim()};var X,Je,is,Ae,tn,fe,Xe,Et,Ve,sn,oe,rn,nn,br,gr,_r,Uo,jo,Do,qo,Wo,Ho,Vo,ke=class extends Fe{constructor(){super(...arguments),X.add(this),is.set(this,[]),Ae.set(this,{}),tn.set(this,{}),fe.set(this,void 0),Xe.set(this,void 0),Et.set(this,void 0),Ve.set(this,void 0),sn.set(this,void 0),oe.set(this,void 0),rn.set(this,void 0),nn.set(this,void 0),br.set(this,void 0)}[(is=new WeakMap,Ae=new WeakMap,tn=new WeakMap,fe=new WeakMap,Xe=new WeakMap,Et=new WeakMap,Ve=new WeakMap,sn=new WeakMap,oe=new WeakMap,rn=new WeakMap,nn=new WeakMap,br=new WeakMap,X=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",s=>{let o=t.shift();o?o.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(let s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(let o of t)o.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(let o of t)o.reject(s);t.length=0}),{next:()=>f(this,null,function*(){return e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((o,a)=>t.push({resolve:o,reject:a})).then(o=>o?{value:o,done:!1}:{value:void 0,done:!0})}),return:()=>f(this,null,function*(){return this.abort(),{value:void 0,done:!0}})}}static fromReadableStream(e){let t=new Je;return t._run(()=>t._fromReadableStream(e)),t}_fromReadableStream(e,t){return f(this,null,function*(){let r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();let s=xe.fromReadableStream(e,this.controller);try{for(var o=F(s),a,c,h;a=!(c=yield o.next()).done;a=!1){let p=c.value;u(this,X,"m",gr).call(this,p)}}catch{h=[c]}finally{try{a&&(c=o.return)&&(yield c.call(o))}finally{if(h)throw h[0]}}if(s.controller.signal?.aborted)throw new U;return this._addRun(u(this,X,"m",_r).call(this))})}toReadableStream(){return new xe(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,s){let o=new Je;return o._run(()=>o._runToolAssistantStream(e,t,r,l(i({},s),{headers:l(i({},s?.headers),{"X-Stainless-Helper-Method":"stream"})}))),o}_createToolAssistantStream(e,t,r,s){return f(this,null,function*(){let o=s?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));let a=l(i({},r),{stream:!0}),c=yield e.submitToolOutputs(t,a,l(i({},s),{signal:this.controller.signal}));this._connected();try{for(var h=F(c),p,x,g;p=!(x=yield h.next()).done;p=!1){let _=x.value;u(this,X,"m",gr).call(this,_)}}catch{g=[x]}finally{try{p&&(x=h.return)&&(yield x.call(h))}finally{if(g)throw g[0]}}if(c.controller.signal?.aborted)throw new U;return this._addRun(u(this,X,"m",_r).call(this))})}static createThreadAssistantStream(e,t,r){let s=new Je;return s._run(()=>s._threadAssistantStream(e,t,l(i({},r),{headers:l(i({},r?.headers),{"X-Stainless-Helper-Method":"stream"})}))),s}static createAssistantStream(e,t,r,s){let o=new Je;return o._run(()=>o._runAssistantStream(e,t,r,l(i({},s),{headers:l(i({},s?.headers),{"X-Stainless-Helper-Method":"stream"})}))),o}currentEvent(){return u(this,rn,"f")}currentRun(){return u(this,nn,"f")}currentMessageSnapshot(){return u(this,fe,"f")}currentRunStepSnapshot(){return u(this,br,"f")}finalRunSteps(){return f(this,null,function*(){return yield this.done(),Object.values(u(this,Ae,"f"))})}finalMessages(){return f(this,null,function*(){return yield this.done(),Object.values(u(this,tn,"f"))})}finalRun(){return f(this,null,function*(){if(yield this.done(),!u(this,Xe,"f"))throw Error("Final run was not received.");return u(this,Xe,"f")})}_createThreadAssistantStream(e,t,r){return f(this,null,function*(){let s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let o=l(i({},t),{stream:!0}),a=yield e.createAndRun(o,l(i({},r),{signal:this.controller.signal}));this._connected();try{for(var c=F(a),h,p,x;h=!(p=yield c.next()).done;h=!1){let g=p.value;u(this,X,"m",gr).call(this,g)}}catch{x=[p]}finally{try{h&&(p=c.return)&&(yield p.call(c))}finally{if(x)throw x[0]}}if(a.controller.signal?.aborted)throw new U;return this._addRun(u(this,X,"m",_r).call(this))})}_createAssistantStream(e,t,r,s){return f(this,null,function*(){let o=s?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));let a=l(i({},r),{stream:!0}),c=yield e.create(t,a,l(i({},s),{signal:this.controller.signal}));this._connected();try{for(var h=F(c),p,x,g;p=!(x=yield h.next()).done;p=!1){let _=x.value;u(this,X,"m",gr).call(this,_)}}catch{g=[x]}finally{try{p&&(x=h.return)&&(yield x.call(h))}finally{if(g)throw g[0]}}if(c.controller.signal?.aborted)throw new U;return this._addRun(u(this,X,"m",_r).call(this))})}static accumulateDelta(e,t){for(let[r,s]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=s;continue}let o=e[r];if(o==null){e[r]=s;continue}if(r==="index"||r==="type"){e[r]=s;continue}if(typeof o=="string"&&typeof s=="string")o+=s;else if(typeof o=="number"&&typeof s=="number")o+=s;else if(ft(o)&&ft(s))o=this.accumulateDelta(o,s);else if(Array.isArray(o)&&Array.isArray(s)){if(o.every(a=>typeof a=="string"||typeof a=="number")){o.push(...s);continue}for(let a of s){if(!ft(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);let c=a.index;if(c==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof c!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${c}`);let h=o[c];h==null?o.push(a):o[c]=this.accumulateDelta(h,a)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${s}, accValue: ${o}`);e[r]=o}return e}_addRun(e){return e}_threadAssistantStream(e,t,r){return f(this,null,function*(){return yield this._createThreadAssistantStream(t,e,r)})}_runAssistantStream(e,t,r,s){return f(this,null,function*(){return yield this._createAssistantStream(t,e,r,s)})}_runToolAssistantStream(e,t,r,s){return f(this,null,function*(){return yield this._createToolAssistantStream(t,e,r,s)})}};Je=ke,gr=function(e){if(!this.ended)switch(A(this,rn,e,"f"),u(this,X,"m",Do).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":u(this,X,"m",Vo).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":u(this,X,"m",jo).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":u(this,X,"m",Uo).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier");default:}},_r=function(){if(this.ended)throw new w("stream has ended, this shouldn't happen");if(!u(this,Xe,"f"))throw Error("Final run has not been received");return u(this,Xe,"f")},Uo=function(e){let[t,r]=u(this,X,"m",Wo).call(this,e,u(this,fe,"f"));A(this,fe,t,"f"),u(this,tn,"f")[t.id]=t;for(let s of r){let o=t.content[s.index];o?.type=="text"&&this._emit("textCreated",o.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let s of e.data.delta.content){if(s.type=="text"&&s.text){let o=s.text,a=t.content[s.index];if(a&&a.type=="text")this._emit("textDelta",o,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=u(this,Et,"f")){if(u(this,Ve,"f"))switch(u(this,Ve,"f").type){case"text":this._emit("textDone",u(this,Ve,"f").text,u(this,fe,"f"));break;case"image_file":this._emit("imageFileDone",u(this,Ve,"f").image_file,u(this,fe,"f"));break}A(this,Et,s.index,"f")}A(this,Ve,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(u(this,Et,"f")!==void 0){let s=e.data.content[u(this,Et,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,u(this,fe,"f"));break;case"text":this._emit("textDone",s.text,u(this,fe,"f"));break}}u(this,fe,"f")&&this._emit("messageDone",e.data),A(this,fe,void 0,"f")}},jo=function(e){let t=u(this,X,"m",qo).call(this,e);switch(A(this,br,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&t.step_details.type=="tool_calls")for(let o of r.step_details.tool_calls)o.index==u(this,sn,"f")?this._emit("toolCallDelta",o,t.step_details.tool_calls[o.index]):(u(this,oe,"f")&&this._emit("toolCallDone",u(this,oe,"f")),A(this,sn,o.index,"f"),A(this,oe,t.step_details.tool_calls[o.index],"f"),u(this,oe,"f")&&this._emit("toolCallCreated",u(this,oe,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":A(this,br,void 0,"f"),e.data.step_details.type=="tool_calls"&&u(this,oe,"f")&&(this._emit("toolCallDone",u(this,oe,"f")),A(this,oe,void 0,"f")),this._emit("runStepDone",e.data,t);break;case"thread.run.step.in_progress":break}},Do=function(e){u(this,is,"f").push(e),this._emit("event",e)},qo=function(e){switch(e.event){case"thread.run.step.created":return u(this,Ae,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=u(this,Ae,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){let s=Je.accumulateDelta(t,r.delta);u(this,Ae,"f")[e.data.id]=s}return u(this,Ae,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":u(this,Ae,"f")[e.data.id]=e.data;break}if(u(this,Ae,"f")[e.data.id])return u(this,Ae,"f")[e.data.id];throw new Error("No snapshot available")},Wo=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(let o of s.delta.content)if(o.index in t.content){let a=t.content[o.index];t.content[o.index]=u(this,X,"m",Ho).call(this,o,a)}else t.content[o.index]=o,r.push(o);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Ho=function(e,t){return Je.accumulateDelta(t,e)},Vo=function(e){switch(A(this,nn,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":A(this,Xe,e.data,"f"),u(this,oe,"f")&&(this._emit("toolCallDone",u(this,oe,"f")),A(this,oe,void 0,"f"));break;case"thread.run.cancelling":break}};var on=(()=>{class n extends m{constructor(){super(...arguments),this.steps=new vt(this._client)}create(t,r,s){let c=r,{include:o}=c,a=v(c,["include"]);return this._client.post(d`/threads/${t}/runs`,l(i({query:{include:o},body:a},s),{headers:y([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:r.stream??!1}))}retrieve(t,r,s){let{thread_id:o}=r;return this._client.get(d`/threads/${o}/runs/${t}`,l(i({},s),{headers:y([{"OpenAI-Beta":"assistants=v2"},s?.headers])}))}update(t,r,s){let c=r,{thread_id:o}=c,a=v(c,["thread_id"]);return this._client.post(d`/threads/${o}/runs/${t}`,l(i({body:a},s),{headers:y([{"OpenAI-Beta":"assistants=v2"},s?.headers])}))}list(t,r={},s){return this._client.getAPIList(d`/threads/${t}/runs`,S,l(i({query:r},s),{headers:y([{"OpenAI-Beta":"assistants=v2"},s?.headers])}))}cancel(t,r,s){let{thread_id:o}=r;return this._client.post(d`/threads/${o}/runs/${t}/cancel`,l(i({},s),{headers:y([{"OpenAI-Beta":"assistants=v2"},s?.headers])}))}createAndPoll(t,r,s){return f(this,null,function*(){let o=yield this.create(t,r,s);return yield this.poll(o.id,{thread_id:t},s)})}createAndStream(t,r,s){return ke.createAssistantStream(t,this._client.beta.threads.runs,r,s)}poll(t,r,s){return f(this,null,function*(){let o=y([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:a,response:c}=yield this.retrieve(t,r,l(i({},s),{headers:i(i({},s?.headers),o)})).withResponse();switch(a.status){case"queued":case"in_progress":case"cancelling":let h=5e3;if(s?.pollIntervalMs)h=s.pollIntervalMs;else{let p=c.headers.get("openai-poll-after-ms");if(p){let x=parseInt(p);isNaN(x)||(h=x)}}yield ye(h);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return a}}})}stream(t,r,s){return ke.createAssistantStream(t,this._client.beta.threads.runs,r,s)}submitToolOutputs(t,r,s){let c=r,{thread_id:o}=c,a=v(c,["thread_id"]);return this._client.post(d`/threads/${o}/runs/${t}/submit_tool_outputs`,l(i({body:a},s),{headers:y([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:r.stream??!1}))}submitToolOutputsAndPoll(t,r,s){return f(this,null,function*(){let o=yield this.submitToolOutputs(t,r,s);return yield this.poll(o.id,r,s)})}submitToolOutputsStream(t,r,s){return ke.createToolAssistantStream(t,this._client.beta.threads.runs,r,s)}}return n.Steps=vt,n})();var an=(()=>{class n extends m{constructor(){super(...arguments),this.runs=new on(this._client),this.messages=new Rt(this._client)}create(t={},r){return this._client.post("/threads",l(i({body:t},r),{headers:y([{"OpenAI-Beta":"assistants=v2"},r?.headers])}))}retrieve(t,r){return this._client.get(d`/threads/${t}`,l(i({},r),{headers:y([{"OpenAI-Beta":"assistants=v2"},r?.headers])}))}update(t,r,s){return this._client.post(d`/threads/${t}`,l(i({body:r},s),{headers:y([{"OpenAI-Beta":"assistants=v2"},s?.headers])}))}delete(t,r){return this._client.delete(d`/threads/${t}`,l(i({},r),{headers:y([{"OpenAI-Beta":"assistants=v2"},r?.headers])}))}createAndRun(t,r){return this._client.post("/threads/runs",l(i({body:t},r),{headers:y([{"OpenAI-Beta":"assistants=v2"},r?.headers]),stream:t.stream??!1}))}createAndRunPoll(t,r){return f(this,null,function*(){let s=yield this.createAndRun(t,r);return yield this.runs.poll(s.id,{thread_id:s.thread_id},r)})}createAndRunStream(t,r){return ke.createThreadAssistantStream(t,this._client.beta.threads,r)}}return n.Runs=on,n.Messages=Rt,n})();var yr=(()=>{class n extends m{constructor(){super(...arguments),this.realtime=new Zr(this._client),this.chatkit=new en(this._client),this.assistants=new It(this._client),this.threads=new an(this._client)}}return n.Realtime=Zr,n.ChatKit=en,n.Assistants=It,n.Threads=an,n})();var Ke=class extends m{create(e,t){return this._client.post("/completions",l(i({body:e},t),{stream:e.stream??!1}))}};var Ot=class extends m{retrieve(e,t,r){let{container_id:s}=t;return this._client.get(d`/containers/${s}/files/${e}/content`,l(i({},r),{headers:y([{Accept:"application/binary"},r?.headers]),__binaryResponse:!0}))}};var ln=(()=>{class n extends m{constructor(){super(...arguments),this.content=new Ot(this._client)}create(t,r,s){return this._client.post(d`/containers/${t}/files`,se(i({body:r},s),this._client))}retrieve(t,r,s){let{container_id:o}=r;return this._client.get(d`/containers/${o}/files/${t}`,s)}list(t,r={},s){return this._client.getAPIList(d`/containers/${t}/files`,S,i({query:r},s))}delete(t,r,s){let{container_id:o}=r;return this._client.delete(d`/containers/${o}/files/${t}`,l(i({},s),{headers:y([{Accept:"*/*"},s?.headers])}))}}return n.Content=Ot,n})();var wr=(()=>{class n extends m{constructor(){super(...arguments),this.files=new ln(this._client)}create(t,r){return this._client.post("/containers",i({body:t},r))}retrieve(t,r){return this._client.get(d`/containers/${t}`,r)}list(t={},r){return this._client.getAPIList("/containers",S,i({query:t},r))}delete(t,r){return this._client.delete(d`/containers/${t}`,l(i({},r),{headers:y([{Accept:"*/*"},r?.headers])}))}}return n.Files=ln,n})();var kt=class extends m{create(e,t,r){let a=t,{include:s}=a,o=v(a,["include"]);return this._client.post(d`/conversations/${e}/items`,i({query:{include:s},body:o},r))}retrieve(e,t,r){let a=t,{conversation_id:s}=a,o=v(a,["conversation_id"]);return this._client.get(d`/conversations/${s}/items/${e}`,i({query:o},r))}list(e,t={},r){return this._client.getAPIList(d`/conversations/${e}/items`,Re,i({query:t},r))}delete(e,t,r){let{conversation_id:s}=t;return this._client.delete(d`/conversations/${s}/items/${e}`,r)}};var xr=(()=>{class n extends m{constructor(){super(...arguments),this.items=new kt(this._client)}create(t={},r){return this._client.post("/conversations",i({body:t},r))}retrieve(t,r){return this._client.get(d`/conversations/${t}`,r)}update(t,r,s){return this._client.post(d`/conversations/${t}`,i({body:r},s))}delete(t,r){return this._client.delete(d`/conversations/${t}`,r)}}return n.Items=kt,n})();var Ge=class extends m{create(e,t){let r=!!e.encoding_format,s=r?e.encoding_format:"base64";r&&N(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let o=this._client.post("/embeddings",i({body:l(i({},e),{encoding_format:s})},t));return r?o:(N(this._client).debug("embeddings/decoding base64 embeddings from base64"),o._thenUnwrap(a=>(a&&a.data&&a.data.forEach(c=>{let h=c.embedding;c.embedding=Bo(h)}),a)))}};var Tt=class extends m{retrieve(e,t,r){let{eval_id:s,run_id:o}=t;return this._client.get(d`/evals/${s}/runs/${o}/output_items/${e}`,r)}list(e,t,r){let a=t,{eval_id:s}=a,o=v(a,["eval_id"]);return this._client.getAPIList(d`/evals/${s}/runs/${e}/output_items`,S,i({query:o},r))}};var cn=(()=>{class n extends m{constructor(){super(...arguments),this.outputItems=new Tt(this._client)}create(t,r,s){return this._client.post(d`/evals/${t}/runs`,i({body:r},s))}retrieve(t,r,s){let{eval_id:o}=r;return this._client.get(d`/evals/${o}/runs/${t}`,s)}list(t,r={},s){return this._client.getAPIList(d`/evals/${t}/runs`,S,i({query:r},s))}delete(t,r,s){let{eval_id:o}=r;return this._client.delete(d`/evals/${o}/runs/${t}`,s)}cancel(t,r,s){let{eval_id:o}=r;return this._client.post(d`/evals/${o}/runs/${t}`,s)}}return n.OutputItems=Tt,n})();var Ir=(()=>{class n extends m{constructor(){super(...arguments),this.runs=new cn(this._client)}create(t,r){return this._client.post("/evals",i({body:t},r))}retrieve(t,r){return this._client.get(d`/evals/${t}`,r)}update(t,r,s){return this._client.post(d`/evals/${t}`,i({body:r},s))}list(t={},r){return this._client.getAPIList("/evals",S,i({query:t},r))}delete(t,r){return this._client.delete(d`/evals/${t}`,r)}}return n.Runs=cn,n})();var ze=class extends m{create(e,t){return this._client.post("/files",se(i({body:e},t),this._client))}retrieve(e,t){return this._client.get(d`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",S,i({query:e},t))}delete(e,t){return this._client.delete(d`/files/${e}`,t)}content(e,t){return this._client.get(d`/files/${e}/content`,l(i({},t),{headers:y([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0}))}waitForProcessing(s){return f(this,arguments,function*(e,{pollInterval:t=5e3,maxWait:r=1800*1e3}={}){let o=new Set(["processed","error","deleted"]),a=Date.now(),c=yield this.retrieve(e);for(;!c.status||!o.has(c.status);)if(yield ye(t),c=yield this.retrieve(e),Date.now()-a>r)throw new $e({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return c})}};var $t=class extends m{};var Mt=class extends m{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",i({body:e},t))}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",i({body:e},t))}};var un=(()=>{class n extends m{constructor(){super(...arguments),this.graders=new Mt(this._client)}}return n.Graders=Mt,n})();var Ft=class extends m{create(e,t,r){return this._client.getAPIList(d`/fine_tuning/checkpoints/${e}/permissions`,Ie,i({body:t,method:"post"},r))}retrieve(e,t={},r){return this._client.get(d`/fine_tuning/checkpoints/${e}/permissions`,i({query:t},r))}delete(e,t,r){let{fine_tuned_model_checkpoint:s}=t;return this._client.delete(d`/fine_tuning/checkpoints/${s}/permissions/${e}`,r)}};var dn=(()=>{class n extends m{constructor(){super(...arguments),this.permissions=new Ft(this._client)}}return n.Permissions=Ft,n})();var Nt=class extends m{list(e,t={},r){return this._client.getAPIList(d`/fine_tuning/jobs/${e}/checkpoints`,S,i({query:t},r))}};var fn=(()=>{class n extends m{constructor(){super(...arguments),this.checkpoints=new Nt(this._client)}create(t,r){return this._client.post("/fine_tuning/jobs",i({body:t},r))}retrieve(t,r){return this._client.get(d`/fine_tuning/jobs/${t}`,r)}list(t={},r){return this._client.getAPIList("/fine_tuning/jobs",S,i({query:t},r))}cancel(t,r){return this._client.post(d`/fine_tuning/jobs/${t}/cancel`,r)}listEvents(t,r={},s){return this._client.getAPIList(d`/fine_tuning/jobs/${t}/events`,S,i({query:r},s))}pause(t,r){return this._client.post(d`/fine_tuning/jobs/${t}/pause`,r)}resume(t,r){return this._client.post(d`/fine_tuning/jobs/${t}/resume`,r)}}return n.Checkpoints=Nt,n})();var Ar=(()=>{class n extends m{constructor(){super(...arguments),this.methods=new $t(this._client),this.jobs=new fn(this._client),this.checkpoints=new dn(this._client),this.alpha=new un(this._client)}}return n.Methods=$t,n.Jobs=fn,n.Checkpoints=dn,n.Alpha=un,n})();var Lt=class extends m{};var Pr=(()=>{class n extends m{constructor(){super(...arguments),this.graderModels=new Lt(this._client)}}return n.GraderModels=Lt,n})();var Qe=class extends m{createVariation(e,t){return this._client.post("/images/variations",se(i({body:e},t),this._client))}edit(e,t){return this._client.post("/images/edits",se(l(i({body:e},t),{stream:e.stream??!1}),this._client))}generate(e,t){return this._client.post("/images/generations",l(i({body:e},t),{stream:e.stream??!1}))}};var Ye=class extends m{retrieve(e,t){return this._client.get(d`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Ie,e)}delete(e,t){return this._client.delete(d`/models/${e}`,t)}};var Ze=class extends m{create(e,t){return this._client.post("/moderations",i({body:e},t))}};var Bt=class extends m{accept(e,t,r){return this._client.post(d`/realtime/calls/${e}/accept`,l(i({body:t},r),{headers:y([{Accept:"*/*"},r?.headers])}))}hangup(e,t){return this._client.post(d`/realtime/calls/${e}/hangup`,l(i({},t),{headers:y([{Accept:"*/*"},t?.headers])}))}refer(e,t,r){return this._client.post(d`/realtime/calls/${e}/refer`,l(i({body:t},r),{headers:y([{Accept:"*/*"},r?.headers])}))}reject(e,t={},r){return this._client.post(d`/realtime/calls/${e}/reject`,l(i({body:t},r),{headers:y([{Accept:"*/*"},r?.headers])}))}};var Ut=class extends m{create(e,t){return this._client.post("/realtime/client_secrets",i({body:e},t))}};var Cr=(()=>{class n extends m{constructor(){super(...arguments),this.clientSecrets=new Ut(this._client),this.calls=new Bt(this._client)}}return n.ClientSecrets=Ut,n.Calls=Bt,n})();function Jo(n,e){return!e||!ca(e)?l(i({},n),{output_parsed:null,output:n.output.map(t=>t.type==="function_call"?l(i({},t),{parsed_arguments:null}):t.type==="message"?l(i({},t),{content:t.content.map(r=>l(i({},r),{parsed:null}))}):t)}):as(n,e)}function as(n,e){let t=n.output.map(s=>{if(s.type==="function_call")return l(i({},s),{parsed_arguments:fa(e,s)});if(s.type==="message"){let o=s.content.map(a=>a.type==="output_text"?l(i({},a),{parsed:la(e,a.text)}):a);return l(i({},s),{content:o})}return s}),r=Object.assign({},n,{output:t});return Object.getOwnPropertyDescriptor(n,"output_text")||mn(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(let s of r.output)if(s.type==="message"){for(let o of s.content)if(o.type==="output_text"&&o.parsed!==null)return o.parsed}return null}}),r}function la(n,e){return n.text?.format?.type!=="json_schema"?null:"$parseRaw"in n.text?.format?(n.text?.format).$parseRaw(e):JSON.parse(e)}function ca(n){return!!ir(n.text?.format)}function ua(n){return n?.$brand==="auto-parseable-tool"}function da(n,e){return n.find(t=>t.type==="function"&&t.name===e)}function fa(n,e){let t=da(n.tools??[],e.name);return l(i(i({},e),e),{parsed_arguments:ua(t)?t.$parseRaw(e.arguments):t?.strict?JSON.parse(e.arguments):null})}function mn(n){let e=[];for(let t of n.output)if(t.type==="message")for(let r of t.content)r.type==="output_text"&&e.push(r.text);n.output_text=e.join("")}var jt,pn,Le,hn,Xo,Ko,Go,zo,gn=class n extends Fe{constructor(e){super(),jt.add(this),pn.set(this,void 0),Le.set(this,void 0),hn.set(this,void 0),A(this,pn,e,"f")}static createResponse(e,t,r){let s=new n(t);return s._run(()=>s._createOrRetrieveResponse(e,t,l(i({},r),{headers:l(i({},r?.headers),{"X-Stainless-Helper-Method":"stream"})}))),s}_createOrRetrieveResponse(e,t,r){return f(this,null,function*(){let s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),u(this,jt,"m",Xo).call(this);let o,a=null;"response_id"in t?(o=yield e.responses.retrieve(t.response_id,{stream:!0},l(i({},r),{signal:this.controller.signal,stream:!0})),a=t.starting_after??null):o=yield e.responses.create(l(i({},t),{stream:!0}),l(i({},r),{signal:this.controller.signal})),this._connected();try{for(var c=F(o),h,p,x;h=!(p=yield c.next()).done;h=!1){let g=p.value;u(this,jt,"m",Ko).call(this,g,a)}}catch{x=[p]}finally{try{h&&(p=c.return)&&(yield p.call(c))}finally{if(x)throw x[0]}}if(o.controller.signal?.aborted)throw new U;return u(this,jt,"m",Go).call(this)})}[(pn=new WeakMap,Le=new WeakMap,hn=new WeakMap,jt=new WeakSet,Xo=function(){this.ended||A(this,Le,void 0,"f")},Ko=function(t,r){if(this.ended)return;let s=(a,c)=>{(r==null||c.sequence_number>r)&&this._emit(a,c)},o=u(this,jt,"m",zo).call(this,t);switch(s("event",t),t.type){case"response.output_text.delta":{let a=o.output[t.output_index];if(!a)throw new w(`missing output at index ${t.output_index}`);if(a.type==="message"){let c=a.content[t.content_index];if(!c)throw new w(`missing content at index ${t.content_index}`);if(c.type!=="output_text")throw new w(`expected content to be 'output_text', got ${c.type}`);s("response.output_text.delta",l(i({},t),{snapshot:c.text}))}break}case"response.function_call_arguments.delta":{let a=o.output[t.output_index];if(!a)throw new w(`missing output at index ${t.output_index}`);a.type==="function_call"&&s("response.function_call_arguments.delta",l(i({},t),{snapshot:a.arguments}));break}default:s(t.type,t);break}},Go=function(){if(this.ended)throw new w("stream has ended, this shouldn't happen");let t=u(this,Le,"f");if(!t)throw new w("request ended without sending any events");A(this,Le,void 0,"f");let r=ma(t,u(this,pn,"f"));return A(this,hn,r,"f"),r},zo=function(t){let r=u(this,Le,"f");if(!r){if(t.type!=="response.created")throw new w(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return r=A(this,Le,t.response,"f"),r}switch(t.type){case"response.output_item.added":{r.output.push(t.item);break}case"response.content_part.added":{let s=r.output[t.output_index];if(!s)throw new w(`missing output at index ${t.output_index}`);let o=s.type,a=t.part;o==="message"&&a.type!=="reasoning_text"?s.content.push(a):o==="reasoning"&&a.type==="reasoning_text"&&(s.content||(s.content=[]),s.content.push(a));break}case"response.output_text.delta":{let s=r.output[t.output_index];if(!s)throw new w(`missing output at index ${t.output_index}`);if(s.type==="message"){let o=s.content[t.content_index];if(!o)throw new w(`missing content at index ${t.content_index}`);if(o.type!=="output_text")throw new w(`expected content to be 'output_text', got ${o.type}`);o.text+=t.delta}break}case"response.function_call_arguments.delta":{let s=r.output[t.output_index];if(!s)throw new w(`missing output at index ${t.output_index}`);s.type==="function_call"&&(s.arguments+=t.delta);break}case"response.reasoning_text.delta":{let s=r.output[t.output_index];if(!s)throw new w(`missing output at index ${t.output_index}`);if(s.type==="reasoning"){let o=s.content?.[t.content_index];if(!o)throw new w(`missing content at index ${t.content_index}`);if(o.type!=="reasoning_text")throw new w(`expected content to be 'reasoning_text', got ${o.type}`);o.text+=t.delta}break}case"response.completed":{A(this,Le,t.response,"f");break}}return r},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",s=>{let o=t.shift();o?o.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(let s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(let o of t)o.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(let o of t)o.reject(s);t.length=0}),{next:()=>f(this,null,function*(){return e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((o,a)=>t.push({resolve:o,reject:a})).then(o=>o?{value:o,done:!1}:{value:void 0,done:!0})}),return:()=>f(this,null,function*(){return this.abort(),{value:void 0,done:!0}})}}finalResponse(){return f(this,null,function*(){yield this.done();let e=u(this,hn,"f");if(!e)throw new w("stream ended without producing a ChatCompletion");return e})}};function ma(n,e){return Jo(n,e)}var Dt=class extends m{list(e,t={},r){return this._client.getAPIList(d`/responses/${e}/input_items`,S,i({query:t},r))}};var qt=class extends m{count(e={},t){return this._client.post("/responses/input_tokens",i({body:e},t))}};var Sr=(()=>{class n extends m{constructor(){super(...arguments),this.inputItems=new Dt(this._client),this.inputTokens=new qt(this._client)}create(t,r){return this._client.post("/responses",l(i({body:t},r),{stream:t.stream??!1}))._thenUnwrap(s=>("object"in s&&s.object==="response"&&mn(s),s))}retrieve(t,r={},s){return this._client.get(d`/responses/${t}`,l(i({query:r},s),{stream:r?.stream??!1}))._thenUnwrap(o=>("object"in o&&o.object==="response"&&mn(o),o))}delete(t,r){return this._client.delete(d`/responses/${t}`,l(i({},r),{headers:y([{Accept:"*/*"},r?.headers])}))}parse(t,r){return this._client.responses.create(t,r)._thenUnwrap(s=>as(s,t))}stream(t,r){return gn.createResponse(this._client,t,r)}cancel(t,r){return this._client.post(d`/responses/${t}/cancel`,r)}}return n.InputItems=Dt,n.InputTokens=qt,n})();var Wt=class extends m{create(e,t,r){return this._client.post(d`/uploads/${e}/parts`,se(i({body:t},r),this._client))}};var Rr=(()=>{class n extends m{constructor(){super(...arguments),this.parts=new Wt(this._client)}create(t,r){return this._client.post("/uploads",i({body:t},r))}cancel(t,r){return this._client.post(d`/uploads/${t}/cancel`,r)}complete(t,r,s){return this._client.post(d`/uploads/${t}/complete`,i({body:r},s))}}return n.Parts=Wt,n})();var Qo=n=>f(null,null,function*(){let e=yield Promise.allSettled(n),t=e.filter(s=>s.status==="rejected");if(t.length){for(let s of t)console.error(s.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}let r=[];for(let s of e)s.status==="fulfilled"&&r.push(s.value);return r});var Ht=class extends m{create(e,t,r){return this._client.post(d`/vector_stores/${e}/file_batches`,l(i({body:t},r),{headers:y([{"OpenAI-Beta":"assistants=v2"},r?.headers])}))}retrieve(e,t,r){let{vector_store_id:s}=t;return this._client.get(d`/vector_stores/${s}/file_batches/${e}`,l(i({},r),{headers:y([{"OpenAI-Beta":"assistants=v2"},r?.headers])}))}cancel(e,t,r){let{vector_store_id:s}=t;return this._client.post(d`/vector_stores/${s}/file_batches/${e}/cancel`,l(i({},r),{headers:y([{"OpenAI-Beta":"assistants=v2"},r?.headers])}))}createAndPoll(e,t,r){return f(this,null,function*(){let s=yield this.create(e,t);return yield this.poll(e,s.id,r)})}listFiles(e,t,r){let a=t,{vector_store_id:s}=a,o=v(a,["vector_store_id"]);return this._client.getAPIList(d`/vector_stores/${s}/file_batches/${e}/files`,S,l(i({query:o},r),{headers:y([{"OpenAI-Beta":"assistants=v2"},r?.headers])}))}poll(e,t,r){return f(this,null,function*(){let s=y([r?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":r?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:o,response:a}=yield this.retrieve(t,{vector_store_id:e},l(i({},r),{headers:s})).withResponse();switch(o.status){case"in_progress":let c=5e3;if(r?.pollIntervalMs)c=r.pollIntervalMs;else{let h=a.headers.get("openai-poll-after-ms");if(h){let p=parseInt(h);isNaN(p)||(c=p)}}yield ye(c);break;case"failed":case"cancelled":case"completed":return o}}})}uploadAndPoll(o,a,c){return f(this,arguments,function*(e,{files:t,fileIds:r=[]},s){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let h=s?.maxConcurrency??5,p=Math.min(h,t.length),x=this._client,g=t.values(),_=[...r];function b(K){return f(this,null,function*(){for(let $ of K){let E=yield x.files.create({file:$,purpose:"assistants"},s);_.push(E.id)}})}let I=Array(p).fill(g).map(b);return yield Qo(I),yield this.createAndPoll(e,{file_ids:_})})}};var Vt=class extends m{create(e,t,r){return this._client.post(d`/vector_stores/${e}/files`,l(i({body:t},r),{headers:y([{"OpenAI-Beta":"assistants=v2"},r?.headers])}))}retrieve(e,t,r){let{vector_store_id:s}=t;return this._client.get(d`/vector_stores/${s}/files/${e}`,l(i({},r),{headers:y([{"OpenAI-Beta":"assistants=v2"},r?.headers])}))}update(e,t,r){let a=t,{vector_store_id:s}=a,o=v(a,["vector_store_id"]);return this._client.post(d`/vector_stores/${s}/files/${e}`,l(i({body:o},r),{headers:y([{"OpenAI-Beta":"assistants=v2"},r?.headers])}))}list(e,t={},r){return this._client.getAPIList(d`/vector_stores/${e}/files`,S,l(i({query:t},r),{headers:y([{"OpenAI-Beta":"assistants=v2"},r?.headers])}))}delete(e,t,r){let{vector_store_id:s}=t;return this._client.delete(d`/vector_stores/${s}/files/${e}`,l(i({},r),{headers:y([{"OpenAI-Beta":"assistants=v2"},r?.headers])}))}createAndPoll(e,t,r){return f(this,null,function*(){let s=yield this.create(e,t,r);return yield this.poll(e,s.id,r)})}poll(e,t,r){return f(this,null,function*(){let s=y([r?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":r?.pollIntervalMs?.toString()??void 0}]);for(;;){let o=yield this.retrieve(t,{vector_store_id:e},l(i({},r),{headers:s})).withResponse(),a=o.data;switch(a.status){case"in_progress":let c=5e3;if(r?.pollIntervalMs)c=r.pollIntervalMs;else{let h=o.response.headers.get("openai-poll-after-ms");if(h){let p=parseInt(h);isNaN(p)||(c=p)}}yield ye(c);break;case"failed":case"completed":return a}}})}upload(e,t,r){return f(this,null,function*(){let s=yield this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:s.id},r)})}uploadAndPoll(e,t,r){return f(this,null,function*(){let s=yield this.upload(e,t,r);return yield this.poll(e,s.id,r)})}content(e,t,r){let{vector_store_id:s}=t;return this._client.getAPIList(d`/vector_stores/${s}/files/${e}/content`,Ie,l(i({},r),{headers:y([{"OpenAI-Beta":"assistants=v2"},r?.headers])}))}};var vr=(()=>{class n extends m{constructor(){super(...arguments),this.files=new Vt(this._client),this.fileBatches=new Ht(this._client)}create(t,r){return this._client.post("/vector_stores",l(i({body:t},r),{headers:y([{"OpenAI-Beta":"assistants=v2"},r?.headers])}))}retrieve(t,r){return this._client.get(d`/vector_stores/${t}`,l(i({},r),{headers:y([{"OpenAI-Beta":"assistants=v2"},r?.headers])}))}update(t,r,s){return this._client.post(d`/vector_stores/${t}`,l(i({body:r},s),{headers:y([{"OpenAI-Beta":"assistants=v2"},s?.headers])}))}list(t={},r){return this._client.getAPIList("/vector_stores",S,l(i({query:t},r),{headers:y([{"OpenAI-Beta":"assistants=v2"},r?.headers])}))}delete(t,r){return this._client.delete(d`/vector_stores/${t}`,l(i({},r),{headers:y([{"OpenAI-Beta":"assistants=v2"},r?.headers])}))}search(t,r,s){return this._client.getAPIList(d`/vector_stores/${t}/search`,Ie,l(i({body:r,method:"post"},s),{headers:y([{"OpenAI-Beta":"assistants=v2"},s?.headers])}))}}return n.Files=Vt,n.FileBatches=Ht,n})();var et=class extends m{create(e,t){return this._client.post("/videos",Wn(i({body:e},t),this._client))}retrieve(e,t){return this._client.get(d`/videos/${e}`,t)}list(e={},t){return this._client.getAPIList("/videos",Re,i({query:e},t))}delete(e,t){return this._client.delete(d`/videos/${e}`,t)}downloadContent(e,t={},r){return this._client.get(d`/videos/${e}/content`,l(i({query:t},r),{headers:y([{Accept:"application/binary"},r?.headers]),__binaryResponse:!0}))}remix(e,t,r){return this._client.post(d`/videos/${e}/remix`,Wn(i({body:t},r),this._client))}};var Jt,Yo,_n,tt=class extends m{constructor(){super(...arguments),Jt.add(this)}unwrap(o,a){return f(this,arguments,function*(e,t,r=this._client.webhookSecret,s=300){return yield this.verifySignature(e,t,r,s),JSON.parse(e)})}verifySignature(o,a){return f(this,arguments,function*(e,t,r=this._client.webhookSecret,s=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");u(this,Jt,"m",Yo).call(this,r);let c=y([t]).values,h=u(this,Jt,"m",_n).call(this,c,"webhook-signature"),p=u(this,Jt,"m",_n).call(this,c,"webhook-timestamp"),x=u(this,Jt,"m",_n).call(this,c,"webhook-id"),g=parseInt(p,10);if(isNaN(g))throw new be("Invalid webhook timestamp format");let _=Math.floor(Date.now()/1e3);if(_-g>s)throw new be("Webhook timestamp is too old");if(g>_+s)throw new be("Webhook timestamp is too new");let b=h.split(" ").map(E=>E.startsWith("v1,")?E.substring(3):E),I=r.startsWith("whsec_")?Buffer.from(r.replace("whsec_",""),"base64"):Buffer.from(r,"utf-8"),K=x?`${x}.${p}.${e}`:`${p}.${e}`,$=yield crypto.subtle.importKey("raw",I,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let E of b)try{let P=Buffer.from(E,"base64");if(yield crypto.subtle.verify("HMAC",$,P,new TextEncoder().encode(K)))return}catch{continue}throw new be("The given webhook signature does not match the expected signature")})}};Jt=new WeakSet,Yo=function(e){if(typeof e!="string"||e.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},_n=function(e,t){if(!e)throw new Error("Headers are required");let r=e.get(t);if(r==null)throw new Error(`Missing required header: ${t}`);return r};var ls,cs,bn,Zo,C=class{constructor(c={}){var h=c,{baseURL:e=de("OPENAI_BASE_URL"),apiKey:t=de("OPENAI_API_KEY"),organization:r=de("OPENAI_ORG_ID")??null,project:s=de("OPENAI_PROJECT_ID")??null,webhookSecret:o=de("OPENAI_WEBHOOK_SECRET")??null}=h,a=v(h,["baseURL","apiKey","organization","project","webhookSecret"]);if(ls.add(this),bn.set(this,void 0),this.completions=new Ke(this),this.chat=new pr(this),this.embeddings=new Ge(this),this.files=new ze(this),this.images=new Qe(this),this.audio=new hr(this),this.moderations=new Ze(this),this.models=new Ye(this),this.fineTuning=new Ar(this),this.graders=new Pr(this),this.vectorStores=new vr(this),this.webhooks=new tt(this),this.beta=new yr(this),this.batches=new He(this),this.uploads=new Rr(this),this.responses=new Sr(this),this.realtime=new Cr(this),this.conversations=new xr(this),this.evals=new Ir(this),this.containers=new wr(this),this.videos=new et(this),t===void 0)throw new w("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");let p=l(i({apiKey:t,organization:r,project:s,webhookSecret:o},a),{baseURL:e||"https://api.openai.com/v1"});if(!p.dangerouslyAllowBrowser&&oo())throw new w(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);this.baseURL=p.baseURL,this.timeout=p.timeout??cs.DEFAULT_TIMEOUT,this.logger=p.logger??console;let x="warn";this.logLevel=x,this.logLevel=Ln(p.logLevel,"ClientOptions.logLevel",this)??Ln(de("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??x,this.fetchOptions=p.fetchOptions,this.maxRetries=p.maxRetries??2,this.fetch=p.fetch??ao(),A(this,bn,co,"f"),this._options=p,this.apiKey=typeof t=="string"?t:"Missing Key",this.organization=r,this.project=s,this.webhookSecret=o}withOptions(e){return new this.constructor(i(l(i({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret}),e))}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}authHeaders(e){return f(this,null,function*(){return y([{Authorization:`Bearer ${this.apiKey}`}])})}stringifyQuery(e){return Fn(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${Me}`}defaultIdempotencyKey(){return`stainless-node-retry-${Cn()}`}makeStatusError(e,t,r,s){return j.generate(e,t,r,s)}_callApiKey(){return f(this,null,function*(){let e=this._options.apiKey;if(typeof e!="function")return!1;let t;try{t=yield e()}catch(r){throw r instanceof w?r:new w(`Failed to get token from 'apiKey' function: ${r.message}`,{cause:r})}if(typeof t!="string"||!t)throw new w(`Expected 'apiKey' function argument to return a string but it returned ${t}`);return this.apiKey=t,!0})}buildURL(e,t,r){let s=!u(this,ls,"m",Zo).call(this)&&r||this.baseURL,o=Qs(e)?new URL(e):new URL(s+(s.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),a=this.defaultQuery();return Ys(a)||(t=i(i({},a),t)),typeof t=="object"&&t&&!Array.isArray(t)&&(o.search=this.stringifyQuery(t)),o.toString()}prepareOptions(e){return f(this,null,function*(){yield this._callApiKey()})}prepareRequest(s,o){return f(this,arguments,function*(e,{url:t,options:r}){})}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(s=>i({method:e,path:t},s)))}request(e,t=null){return new je(this,this.makeRequest(e,t,void 0))}makeRequest(e,t,r){return f(this,null,function*(){let s=yield e,o=s.maxRetries??this.maxRetries;t==null&&(t=o),yield this.prepareOptions(s);let{req:a,url:c,timeout:h}=yield this.buildRequest(s,{retryCount:o-t});yield this.prepareRequest(a,{url:c,options:s});let p="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),x=r===void 0?"":`, retryOf: ${r}`,g=Date.now();if(N(this).debug(`[${p}] sending request`,Se({retryOfRequestLogID:r,method:s.method,url:c,options:s,headers:a.headers})),s.signal?.aborted)throw new U;let _=new AbortController,b=yield this.fetchWithTimeout(c,a,h,_).catch(Yt),I=Date.now();if(b instanceof globalThis.Error){let E=`retrying, ${t} attempts remaining`;if(s.signal?.aborted)throw new U;let P=Qt(b)||/timed? ?out/i.test(String(b)+("cause"in b?String(b.cause):""));if(t)return N(this).info(`[${p}] connection ${P?"timed out":"failed"} - ${E}`),N(this).debug(`[${p}] connection ${P?"timed out":"failed"} (${E})`,Se({retryOfRequestLogID:r,url:c,durationMs:I-g,message:b.message})),this.retryRequest(s,t,r??p);throw N(this).info(`[${p}] connection ${P?"timed out":"failed"} - error; no more retries left`),N(this).debug(`[${p}] connection ${P?"timed out":"failed"} (error; no more retries left)`,Se({retryOfRequestLogID:r,url:c,durationMs:I-g,message:b.message})),P?new $e:new Te({cause:b})}let K=[...b.headers.entries()].filter(([E])=>E==="x-request-id").map(([E,P])=>", "+E+": "+JSON.stringify(P)).join(""),$=`[${p}${x}${K}] ${a.method} ${c} ${b.ok?"succeeded":"failed"} with status ${b.status} in ${I-g}ms`;if(!b.ok){let E=yield this.shouldRetry(b);if(t&&E){let B=`retrying, ${t} attempts remaining`;return yield lo(b.body),N(this).info(`${$} - ${B}`),N(this).debug(`[${p}] response error (${B})`,Se({retryOfRequestLogID:r,url:b.url,status:b.status,headers:b.headers,durationMs:I-g})),this.retryRequest(s,t,r??p,b.headers)}let P=E?"error; no more retries left":"error; not retryable";N(this).info(`${$} - ${P}`);let L=yield b.text().catch(B=>Yt(B).message),W=to(L),H=W?void 0:L;throw N(this).debug(`[${p}] response error (${P})`,Se({retryOfRequestLogID:r,url:b.url,status:b.status,headers:b.headers,message:H,durationMs:Date.now()-g})),this.makeStatusError(b.status,W,H,b.headers)}return N(this).info($),N(this).debug(`[${p}] response start`,Se({retryOfRequestLogID:r,url:b.url,status:b.status,headers:b.headers,durationMs:I-g})),{response:b,options:s,controller:_,requestLogID:p,retryOfRequestLogID:r,startTime:g}})}getAPIList(e,t,r){return this.requestAPIList(t,i({method:"get",path:e},r))}requestAPIList(e,t){let r=this.makeRequest(t,null,void 0);return new nr(this,r,e)}fetchWithTimeout(e,t,r,s){return f(this,null,function*(){let g=t||{},{signal:o,method:a}=g,c=v(g,["signal","method"]);o&&o.addEventListener("abort",()=>s.abort());let h=setTimeout(()=>s.abort(),r),p=globalThis.ReadableStream&&c.body instanceof globalThis.ReadableStream||typeof c.body=="object"&&c.body!==null&&Symbol.asyncIterator in c.body,x=i(l(i({signal:s.signal},p?{duplex:"half"}:{}),{method:"GET"}),c);a&&(x.method=a.toUpperCase());try{return yield this.fetch.call(void 0,e,x)}finally{clearTimeout(h)}})}shouldRetry(e){return f(this,null,function*(){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500})}retryRequest(e,t,r,s){return f(this,null,function*(){let o,a=s?.get("retry-after-ms");if(a){let h=parseFloat(a);Number.isNaN(h)||(o=h)}let c=s?.get("retry-after");if(c&&!o){let h=parseFloat(c);Number.isNaN(h)?o=Date.parse(c)-Date.now():o=h*1e3}if(!(o&&0<=o&&o<60*1e3)){let h=e.maxRetries??this.maxRetries;o=this.calculateDefaultRetryTimeoutMillis(t,h)}return yield ye(o),this.makeRequest(e,t-1,r)})}calculateDefaultRetryTimeoutMillis(e,t){let o=t-e,a=Math.min(.5*Math.pow(2,o),8),c=1-Math.random()*.25;return a*c*1e3}buildRequest(r){return f(this,arguments,function*(e,{retryCount:t=0}={}){let s=i({},e),{method:o,path:a,query:c,defaultBaseURL:h}=s,p=this.buildURL(a,c,h);"timeout"in s&&eo("timeout",s.timeout),s.timeout=s.timeout??this.timeout;let{bodyHeaders:x,body:g}=this.buildBody({options:s}),_=yield this.buildHeaders({options:e,method:o,bodyHeaders:x,retryCount:t});return{req:i(i(i(i(i({method:o,headers:_},s.signal&&{signal:s.signal}),globalThis.ReadableStream&&g instanceof globalThis.ReadableStream&&{duplex:"half"}),g&&{body:g}),this.fetchOptions??{}),s.fetchOptions??{}),url:p,timeout:s.timeout}})}buildHeaders(o){return f(this,arguments,function*({options:e,method:t,bodyHeaders:r,retryCount:s}){let a={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);let c=y([a,l(i(i({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(s)},e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{}),io()),{"OpenAI-Organization":this.organization,"OpenAI-Project":this.project}),yield this.authHeaders(e),this._options.defaultHeaders,r,e.headers]);return this.validateHeaders(c),c.values})}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let r=y([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&r.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:Mr(e)}:u(this,bn,"f").call(this,{body:e,headers:r})}};cs=C,bn=new WeakMap,ls=new WeakSet,Zo=function(){return this.baseURL!=="https://api.openai.com/v1"};C.OpenAI=cs;C.DEFAULT_TIMEOUT=6e5;C.OpenAIError=w;C.APIError=j;C.APIConnectionError=Te;C.APIConnectionTimeoutError=$e;C.APIUserAbortError=U;C.NotFoundError=ot;C.ConflictError=it;C.RateLimitError=lt;C.BadRequestError=rt;C.AuthenticationError=nt;C.InternalServerError=ct;C.PermissionDeniedError=st;C.UnprocessableEntityError=at;C.InvalidWebhookSignatureError=be;C.toFile=Wr;C.Completions=Ke;C.Chat=pr;C.Embeddings=Ge;C.Files=ze;C.Images=Qe;C.Audio=hr;C.Moderations=Ze;C.Models=Ye;C.FineTuning=Ar;C.Graders=Pr;C.VectorStores=vr;C.Webhooks=tt;C.Beta=yr;C.Batches=He;C.Uploads=Rr;C.Responses=Sr;C.Realtime=Cr;C.Conversations=xr;C.Evals=Ir;C.Containers=wr;C.Videos=et;var Er=class n extends C{constructor(p={}){var x=p,{baseURL:e=de("OPENAI_BASE_URL"),apiKey:t=de("AZURE_OPENAI_API_KEY"),apiVersion:r=de("OPENAI_API_VERSION"),endpoint:s,deployment:o,azureADTokenProvider:a,dangerouslyAllowBrowser:c}=x,h=v(x,["baseURL","apiKey","apiVersion","endpoint","deployment","azureADTokenProvider","dangerouslyAllowBrowser"]);if(!r)throw new w("The OPENAI_API_VERSION environment variable is missing or empty; either provide it, or instantiate the AzureOpenAI client with an apiVersion option, like new AzureOpenAI({ apiVersion: 'My API Version' }).");if(typeof a=="function"&&(c=!0),!a&&!t)throw new w("Missing credentials. Please pass one of `apiKey` and `azureADTokenProvider`, or set the `AZURE_OPENAI_API_KEY` environment variable.");if(a&&t)throw new w("The `apiKey` and `azureADTokenProvider` arguments are mutually exclusive; only one can be passed at a time.");if(h.defaultQuery=l(i({},h.defaultQuery),{"api-version":r}),e){if(s)throw new w("baseURL and endpoint are mutually exclusive")}else{if(s||(s=process.env.AZURE_OPENAI_ENDPOINT),!s)throw new w("Must provide one of the `baseURL` or `endpoint` arguments, or the `AZURE_OPENAI_ENDPOINT` environment variable");e=`${s}/openai`}super(i(i({apiKey:a??t,baseURL:e},h),c!==void 0?{dangerouslyAllowBrowser:c}:{})),this.apiVersion="",this.apiVersion=r,this.deploymentName=o}buildRequest(r){return f(this,arguments,function*(e,t={}){if(wa.has(e.path)&&e.method==="post"&&e.body!==void 0){if(!ft(e.body))throw new Error("Expected request body to be an object");let s=this.deploymentName||e.body.model||e.__metadata?.model;s!==void 0&&!this.baseURL.includes("/deployments")&&(e.path=`/deployments/${s}${e.path}`)}return Xt(n.prototype,this,"buildRequest").call(this,e,t)})}authHeaders(e){return f(this,null,function*(){return typeof this._options.apiKey=="string"?y([{"api-key":this.apiKey}]):Xt(n.prototype,this,"authHeaders").call(this,e)})}},wa=new Set(["/completions","/chat/completions","/embeddings","/audio/transcriptions","/audio/translations","/audio/speech","/images/generations","/batches","/images/edits"]);var xa=n=>["/evento",n],Ia=()=>[0,.25,.5];function Aa(n,e){n&1&&(O(0,"div",16),ce(1,"ion-spinner",17),O(2,"div"),te(3,"Leyendo contenido de la boleta..."),T()())}function Pa(n,e){if(n&1&&(O(0,"ion-text",18),te(1),T()),n&2){let t=ue();ee(),yn(t.ocrError)}}function Ca(n,e){if(n&1){let t=Kt();O(0,"section",19)(1,"div",20),ce(2,"div",2),O(3,"div",21)(4,"div",22),te(5),T(),O(6,"div",23)(7,"ion-label"),te(8),bs(9,"clpCurrency"),T()(),O(10,"div",24)(11,"ion-button",25),le("click",function(){let s=Y(t).index,o=ue();return Z(o.editarItem(s))}),ce(12,"ion-icon",26),T()(),O(13,"div",24)(14,"ion-button",27),le("click",function(){let s=Y(t).index,o=ue();return Z(o.eliminarItem(s))}),ce(15,"ion-icon",28),T()()()()()}if(n&2){let t=e.$implicit;ee(5),hs(" ",t.name," "),ee(3),yn(ys(9,2,t.price))}}function Sa(n,e){if(n&1){let t=Kt();O(0,"ion-content",29)(1,"div",30)(2,"div",31),le("click",function(){Y(t);let s=ue();return Z(s.abrirCamaraOGaleria(1))}),ce(3,"ion-icon",32),O(4,"span"),te(5,"C\xE1mara"),T()(),O(6,"div",31),le("click",function(){Y(t);let s=ue();return Z(s.abrirCamaraOGaleria(2))}),ce(7,"ion-icon",33),O(8,"span"),te(9,"Galer\xEDa"),T()()()()}}function Ra(n,e){if(n&1){let t=Kt();O(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),te(3,"Agregar item"),T()()(),O(4,"ion-content")(5,"ion-item")(6,"div",34)(7,"ion-label"),te(8,"Nombre"),T(),O(9,"ion-input",35),In("ngModelChange",function(s){Y(t);let o=ue();return xn(o.nombreItem,s)||(o.nombreItem=s),Z(s)}),T()()(),O(10,"ion-item")(11,"div",34)(12,"ion-label"),te(13,"Valor"),T(),O(14,"ion-input",36),In("ngModelChange",function(s){Y(t);let o=ue();return xn(o.valorItem,s)||(o.valorItem=s),Z(s)}),T()()(),O(15,"ion-footer")(16,"div",34)(17,"ion-button",37),le("click",function(){Y(t);let s=ue();return Z(s.agregarItem())}),te(18,"Guardar"),T(),O(19,"ion-button",38),le("click",function(){Y(t);let s=ue();return Z(s.closeModal())}),te(20,"Cancelar"),T()()()()}if(n&2){let t=ue();ee(9),wn("ngModel",t.nombreItem),ee(5),wn("ngModel",t.valorItem),ee(3),Ce("disabled",!t.nombreItem||!t.valorItem)}}var va="https://adria-mi7zki2g-eastus2.cognitiveservices.azure.com/",Ea="gpt-5.1-chat",Oa="gpt-5.1-chat",Yg=(()=>{let e=class e{constructor(){this.nombreItem=null,this.valorItem=null,this.showModal=!1,this.openModal=!1,this.indexItemEdit=null,this.image="",this.recognizedText="",this.actionSheet=kr(qs),this.boletaParseResult=null,this.items=[],this.nuevoNombre="",this.nuevoMonto=null,this.ocrCargando=!1,this.ocrError="",this.base64textString="",this.route=kr(As),this.data=kr(Vs)}abrirCamaraOGaleria(r){return f(this,null,function*(){try{let o=r===1?_e.Camera:r===2?_e.Photos:_e.Prompt,a=yield Gs.getPhoto({quality:80,resultType:Pn.DataUrl,source:o});if(a&&a.dataUrl){let c=a.dataUrl.split(",")[1];yield this.procesarImagenBase64(c);return}}catch(o){console.warn("Camera error or not available, fallback to file input",o)}let s=document.getElementById("ocrInput");s?s.click():this.ocrError="No se encontr\xF3 el input para subir imagen."})}ngOnInit(){let r=Number(this.route.snapshot.paramMap.get("eventoId")),s=this.data.getEventById(r);s&&(this.evento=s,this.items=this.evento.items??[])}agregarItem(){if(this.indexItemEdit!==null){let r=this.items[this.indexItemEdit];if(!this.nombreItem||!this.nombreItem.trim()||!this.valorItem)return;r.name=this.nombreItem.trim(),r.price=Number(this.valorItem)}else{if(!this.nombreItem||!this.nombreItem.trim()||!this.valorItem)return;let r={id:Date.now(),name:this.nombreItem.trim(),price:Number(this.valorItem),participant:[]};this.items.push(r)}this.evento&&(this.evento.items=[...this.items],this.data.saveEvents()),this.nombreItem=null,this.valorItem=null,this.indexItemEdit=null,this.closeModal()}eliminarItem(r){this.items.splice(r,1),this.evento&&(this.evento.items=[...this.items],this.data.saveEvents())}editarItem(r){this.indexItemEdit=r,this.openAddModal();let s=this.items[r];this.nombreItem=s.name,this.valorItem=s.price}procesarImagen(r){return f(this,null,function*(){if(this.ocrError="",r&&r.target&&r.target.files){this.ocrCargando=!0;try{let o=r.target.files[0];if(!o){this.ocrCargando=!1;return}let a=new FileReader;a.onload=c=>{let h=c.target.result,p=btoa(h);this.procesarImagenBase64(p)},a.readAsBinaryString(o)}catch(o){console.error(o),this.ocrError="Error procesando la imagen.",this.ocrCargando=!1}return}if(!!window.cordova)try{yield(yield this.actionSheet.create({header:"Selecciona fuente",buttons:[{text:"C\xE1mara",icon:"camera",handler:()=>f(this,null,function*(){yield this.abrirCamaraOGaleria(1)})},{text:"Galer\xEDa",icon:"images",handler:()=>f(this,null,function*(){yield this.abrirCamaraOGaleria(2)})},{text:"Cancelar",icon:"close",role:"cancel"}]})).present()}catch(o){console.error(o),this.ocrError="No se pudo abrir la opci\xF3n de fuente."}else{let o=document.getElementById("ocrInput");o?o.click():this.ocrError="No se encontr\xF3 el input para subir imagen."}})}procesarImagenBase64(r){return f(this,null,function*(){this.base64textString=r,this.ocrCargando=!0,this.ocrError="";let a={endpoint:va,apiKey:"6OZ1lONsrdQbIhTW2aSvz6iSXuoLlOvun3Pe34jeJZMF6hh6mIzQJQQJ99BKACHYHv6XJ3w3AAAAACOGFrqS",deployment:Oa,apiVersion:"2024-04-01-preview",dangerouslyAllowBrowser:!0},h=yield new Er(a).chat.completions.create({messages:[{role:"user",content:[{type:"text",text:`Identifica los items de la boleta:

Extrae los items en formato JSON, donde cada item tiene 'name', 'cantidad' y 'price'. Si no hay cantidad, asume 1. Si no puedes identificar items, responde con un array vac\xEDo. Identifica el total de la boleta: Identifica el monto de la propina si es que existe Los items que tengan cantidad mayor a 1 deben ser considerados como m\xFAltiples items en la respuesta , es decir todo el monto debe ser distribuido entre los items correspondientes y quedar todos en cantidad 1Revisa si el valor total coincide con la suma de los items y/o de la propina, si no cuadra deja la variable cuadratura en false, pero si calza dejalo en true Ejemplo de respuesta:
{"total": 4500,"propina": 500,"cuadratura": true,"items": [[{"name": "Item1", "cantidad": 2, "price": 3000}, {"name": "Item2", "cantidad": 1, "price": 1500}]]}`},{type:"image_url",image_url:{url:`data:image/jpeg;base64,${r}`}}]}],max_completion_tokens:16384,model:Ea});console.log(h.choices[0].message.content);let p;try{p=JSON.parse(h.choices[0].message.content)}catch{let _=h.choices[0].message.content.match(/\{.*\}/);if(_)p=JSON.parse(_[0]);else throw new Error("Formato de respuesta inv\xE1lido")}if(!p.items||!Array.isArray(p.items))throw new Error("La respuesta no contiene un array de items v\xE1lido");let x=p.items.map(g=>({name:g.name||"",price:Number(g.price)||0,cantidad:g.cantidad?Number(g.cantidad):1,participant:g.participant||[]}));this.evento&&(this.evento.items=[...x],this.data.saveEvents(),this.ocrCargando=!1,this.ngOnInit())})}openAddModal(){this.showModal=!0}closeModal(){this.showModal=!1,this.nuevoNombre="",this.valorItem=null}callGeminiWithImage(r,s){return f(this,null,function*(){let a=`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${zs.geminiApiKey}`,p=yield(yield fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{inline_data:{mime_type:"image/jpeg",data:r}},{text:s}]}]})})).json();if(p.candidates&&p.candidates.length>0)return p.candidates[0].content.parts[0].text;if(p.text)return p.text;throw new Error("Respuesta inesperada de Gemini: "+JSON.stringify(p))})}asignarParticipante(r,s){this.items[r].participant.push(s),this.evento&&(this.evento.items=[...this.items],this.data.saveEvents())}};e.\u0275fac=function(s){return new(s||e)},e.\u0275cmp=ds({type:e,selectors:[["app-items"]],viewQuery:function(s,o){if(s&1&&fs(An,5),s&2){let a;ms(a=ps())&&(o.content=a.first)}},decls:23,vars:12,consts:[["ocrInput",""],[3,"translucent"],["slot","start"],[3,"routerLink"],["slot","end"],["class","spin",4,"ngIf"],["color","danger",4,"ngIf"],["class","flex items-center gap-4 p-1",4,"ngFor","ngForOf"],["id","ocrInput","type","file","accept","image/*","capture","environment",2,"display","none",3,"change"],["slot","fixed",2,"bottom","100px","right","100px","position","absolute"],[3,"click"],["name","camera-sharp"],["slot","fixed",2,"bottom","100px","right","24px","position","absolute"],["name","add-outline"],["handle","true",1,"bottom-sheet-modal",3,"didDismiss","isOpen","initialBreakpoint","breakpoints"],[3,"didDismiss","isOpen"],[1,"spin"],["color","primary"],["color","danger"],[1,"flex","items-center","gap-4","p-1"],[1,"flex","items-center","gap-4","p-3","rounded-lg","bg-white","dark:bg-background-dark/50",2,"background-color","#06192D","width","100%"],[2,"align-items","center","display","flex","width","100%"],[2,"width","35%"],[2,"width","30%"],[2,"width","15%"],["color","primary",3,"click"],["name","create-outline"],["color","danger",3,"click"],["name","trash-outline"],[1,"bottom-sheet-content"],[1,"photo-container"],[1,"photo-option-card",3,"click"],["name","camera-outline"],["name","image-outline"],[1,"flex","flex-col","width-full","margin-top-5"],["autocapitalize","sentences","id","event-name","placeholder","Ej: Cena de fin de a\xF1o","value","",1,"form-input","flex","w-full","min-w-0","flex-1","resize-none","overflow-hidden","rounded-lg","text-[#212529]","dark:text-white","focus:outline-0","focus:ring-2","focus:ring-primary/50","border","border-gray-300","dark:border-gray-600","bg-white","dark:bg-background-dark","h-14","placeholder:text-[#6C757D]","p-[15px]","text-base","font-normal","leading-normal",3,"ngModelChange","ngModel"],["type","number","id","event-value","placeholder","Ej: 10000","value","",1,"form-input","flex","w-full","min-w-0","flex-1","resize-none","overflow-hidden","rounded-lg","text-[#212529]","dark:text-white","focus:outline-0","focus:ring-2","focus:ring-primary/50","border","border-gray-300","dark:border-gray-600","bg-white","dark:bg-background-dark","h-14","placeholder:text-[#6C757D]","p-[15px]","text-base","font-normal","leading-normal",3,"ngModelChange","ngModel"],["expand","block",3,"click","disabled"],["expand","block","color","medium",3,"click"]],template:function(s,o){if(s&1){let a=Kt();O(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-title"),te(3,"Items"),T(),O(4,"ion-buttons",2),ce(5,"ion-back-button",3),T(),ce(6,"ion-buttons",4),T()(),O(7,"ion-content"),Tr(8,Aa,4,0,"div",5)(9,Pa,2,1,"ion-text",6)(10,Ca,16,4,"section",7),O(11,"input",8,0),le("change",function(h){return Y(a),Z(o.procesarImagen(h))}),T()(),O(13,"ion-fab",9)(14,"ion-fab-button",10),le("click",function(){return Y(a),Z(o.openModal=!0)}),ce(15,"ion-icon",11),T()(),O(16,"ion-fab",12)(17,"ion-fab-button",10),le("click",function(){return Y(a),Z(o.openAddModal())}),ce(18,"ion-icon",13),T()(),O(19,"ion-modal",14),le("didDismiss",function(){return Y(a),Z(o.openModal=!1)}),Tr(20,Sa,10,0,"ng-template"),T(),O(21,"ion-modal",15),le("didDismiss",function(){return Y(a),Z(o.closeModal())}),Tr(22,Ra,21,3,"ng-template"),T()}s&2&&(Ce("translucent",!0),ee(5),Ce("routerLink",_s(9,xa,o.evento.id)),ee(3),Ce("ngIf",o.ocrCargando),ee(),Ce("ngIf",o.ocrError),ee(),Ce("ngForOf",o.items),ee(9),Ce("isOpen",o.openModal)("initialBreakpoint",.25)("breakpoints",gs(11,Ia)),ee(2),Ce("isOpen",o.showModal))},dependencies:[Es,Fs,Ds,js,An,Ns,Ls,ks,Os,Ws,Hs,vs,Ss,Rs,ws,Cs,Ps,Is,xs,Ts,$s,Ms,Us,Bs,Js],styles:['@charset "UTF-8";ion-content[_ngcontent-%COMP%]{padding-bottom:var(--padding-bottom, 0px)!important}ion-content[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background: transparent}ion-content[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:1.1rem}ion-content[_ngcontent-%COMP%]   ion-button[color=danger][_ngcontent-%COMP%]{margin-left:.5rem}ion-input[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]{padding:8px 12px!important;background:#fff!important;border-radius:8px!important;font-size:16px!important;box-shadow:none!important;height:40px!important;appearance:textfield}body.keyboard-simulated[_ngcontent-%COMP%]   ion-content[_ngcontent-%COMP%]{padding-bottom:320px!important}body.keyboard-simulated[_ngcontent-%COMP%]   .keyboard-overlay[_ngcontent-%COMP%]{display:block!important}.keyboard-overlay[_ngcontent-%COMP%], .keyboard-overlay-global[_ngcontent-%COMP%]{display:none;position:fixed;left:0;right:0;bottom:0;height:320px;background:#0000000d;z-index:9999}body.keyboard-simulated[_ngcontent-%COMP%]   .keyboard-overlay-global[_ngcontent-%COMP%]{display:block!important}.spin[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center}ion-spinner[_ngcontent-%COMP%]{width:28px;height:28px;stroke:#444;fill:#222}.keyboard-is-open[_ngcontent-%COMP%]   ion-content[_ngcontent-%COMP%]{--overflow: auto}ion-content[_ngcontent-%COMP%]{--padding-bottom: 90px}.footer-visible[_ngcontent-%COMP%]{position:fixed;bottom:env(safe-area-inset-bottom);left:0;right:0;background:var(--ion-background-color, #fff);border-top:1px solid var(--ion-color-medium);box-shadow:0 -2px 8px #0000001a;padding:10px 12px;z-index:9999}.form-row[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center;width:100%;margin:0}.form-row[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{flex:1 1 35%}.form-row[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{flex:0 0 25%}ion-list[_ngcontent-%COMP%]{margin-bottom:1.5rem}ion-modal[_ngcontent-%COMP%]{--width: 90vw;--height: 90vh}ion-footer[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;padding:1rem}.width-full[_ngcontent-%COMP%]{width:100%}.margin-top-5[_ngcontent-%COMP%]{margin-top:1.25rem}.ion-padding-bottom[_ngcontent-%COMP%]{--padding-bottom: 80px}.bottom-sheet-modal[_ngcontent-%COMP%]::part(backdrop){-webkit-backdrop-filter:blur(12px);backdrop-filter:blur(12px);background:#00000059}.bottom-sheet-content[_ngcontent-%COMP%]{--background: transparent;display:flex;justify-content:center;padding-top:20px}.photo-container[_ngcontent-%COMP%]{display:flex;justify-content:space-around;width:100%;padding:0 20px}.photo-option-card[_ngcontent-%COMP%]{width:120px;height:120px;background:var(--ion-color-light);border-radius:20px;box-shadow:0 8px 25px #00000026;display:flex;flex-direction:column;align-items:center;justify-content:center;transition:transform .15s ease,box-shadow .15s ease;cursor:pointer}.photo-option-card[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:42px;color:var(--ion-color-primary)}.photo-option-card[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-top:8px;font-size:16px;font-weight:500}.photo-option-card[_ngcontent-%COMP%]:active{transform:scale(.95);box-shadow:0 4px 14px #0003}@media (prefers-color-scheme: dark){.photo-option-card[_ngcontent-%COMP%]{background:#1e1e1e;box-shadow:0 8px 25px #ffffff0d}}']});let n=e;return n})();export{Yg as ItemsPage};
